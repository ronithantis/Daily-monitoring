<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>××¢×¨×›×ª × ×™×”×•×œ ×˜×™×¤×•×œ ×™×•××™</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Hebrew:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans Hebrew','Segoe UI',sans-serif;background:#faf9f7;-webkit-font-smoothing:antialiased}
button,input,textarea,select{font-family:inherit}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script>
if(!window.storage){window.storage={
get:async function(k){var v=localStorage.getItem(k);if(v===null)throw new Error("Not found");return{key:k,value:v}},
set:async function(k,v){localStorage.setItem(k,v);return{key:k,value:v}},
delete:async function(k){localStorage.removeItem(k);return{key:k,deleted:true}},
list:async function(p){p=p||"";var keys=[];for(var i=0;i<localStorage.length;i++){var k=localStorage.key(i);if(k.indexOf(p)===0)keys.push(k)}return{keys:keys}}
}}
</script>
<script type="text/babel" data-type="module">
const { useState, useEffect, useCallback } = React;


// ============ MEDICATION DATABASE ============
const MEDICATION_DB = [
  { id: "med_1", name: "×“×•× ×¤×–×™×œ (×××•×¨×™×˜, ××¡× ×˜×”)", generic: "Donepezil", category: "××œ×¦×”×™×™××¨", purpose: "×©×™×¤×•×¨ ×ª×¡××™× ×™× ×§×•×’× ×™×˜×™×‘×™×™× ×‘××œ×¦×”×™×™××¨" },
  { id: "med_2", name: "×¨×™×‘×¡×˜×™×’××™×Ÿ (××§×¡×œ×•×Ÿ)", generic: "Rivastigmine", category: "××œ×¦×”×™×™××¨", purpose: "××œ×¦×”×™×™××¨ ×§×œâ€“×‘×™× ×•× ×™" },
  { id: "med_3", name: "×’×œ× ×˜××™×Ÿ (×¨×× ×™×œ)", generic: "Galantamine", category: "××œ×¦×”×™×™××¨", purpose: "××œ×¦×”×™×™××¨ ×§×œâ€“×‘×™× ×•× ×™" },
  { id: "med_4", name: "××× ×˜×™×Ÿ (×××•×§×¡/××‘×™×§×¡×”)", generic: "Memantine", category: "××œ×¦×”×™×™××¨", purpose: "××œ×¦×”×™×™××¨ ×‘×™× ×•× ×™â€“×—××•×¨" },
  { id: "med_5", name: "×¡×¨×˜×¨×œ×™×Ÿ (×œ×•×¡×˜×¨×œ)", generic: "Sertraline", category: "×“×™×›××•×Ÿ/×—×¨×“×”", purpose: "×“×™×›××•×Ÿ/×—×¨×“×”" },
  { id: "med_6", name: "×¤×œ×•××•×§×¡×˜×™×Ÿ (×¤×¨×•×–×§)", generic: "Fluoxetine", category: "×“×™×›××•×Ÿ/×—×¨×“×”", purpose: "×“×™×›××•×Ÿ/×—×¨×“×”" },
  { id: "med_7", name: "××¡×¦×™×˜×œ×•×¤×¨× (×¦×™×¤×¨×œ×§×¡)", generic: "Escitalopram", category: "×“×™×›××•×Ÿ/×—×¨×“×”", purpose: "×“×™×›××•×Ÿ, ×—×¨×“×”" },
  { id: "med_8", name: "×¡×™×˜×œ×•×¤×¨× (×¦×™×¤×¨××™×œ)", generic: "Citalopram", category: "×“×™×›××•×Ÿ/×—×¨×“×”", purpose: "×“×™×›××•×Ÿ/×—×¨×“×”" },
  { id: "med_9", name: "××™×¨×˜×–×¤×™×Ÿ (×¨××¨×•×Ÿ)", generic: "Mirtazapine", category: "×“×™×›××•×Ÿ", purpose: "×“×™×›××•×Ÿ; ××•×¢×™×œ ×›×©×™×© ×™×¨×™×“×” ×‘×ª×™××‘×•×Ÿ/×©×™× ×”" },
  { id: "med_10", name: "×•× ×œ×¤×§×¡×™×Ÿ", generic: "Venlafaxine", category: "×“×™×›××•×Ÿ/×—×¨×“×”", purpose: "×“×™×›××•×Ÿ/×—×¨×“×”" },
  { id: "med_11", name: "×“×•×œ×•×§×¡×˜×™×Ÿ", generic: "Duloxetine", category: "×“×™×›××•×Ÿ/×›××‘", purpose: "×“×™×›××•×Ÿ + ×›××‘ × ×•×™×¨×•×¤×ª×™" },
  { id: "med_12", name: "×•×•×œ×‘×•×˜×¨×™×Ÿ", generic: "Bupropion", category: "×“×™×›××•×Ÿ", purpose: "×“×™×›××•×Ÿ" },
  { id: "med_13", name: "×œ×•×¨××–×¤×× (×œ×•×¨×™×‘×Ÿ)", generic: "Lorazepam", category: "×—×¨×“×”/×©×™× ×”", purpose: "×—×¨×“×”/×©×™× ×”" },
  { id: "med_14", name: "×–×•×œ×¤×™×“× (×¡×˜×™×œ× ×•×§×¡)", generic: "Zolpidem", category: "×©×™× ×”", purpose: "× ×“×•×“×™ ×©×™× ×”" },
  { id: "med_15", name: "×‘×•×¡×¤×™×¨×•×Ÿ", generic: "Buspirone", category: "×—×¨×“×”", purpose: "×—×¨×“×”" },
  { id: "med_16", name: "×¨×™×¡×¤×¨×™×“×•×Ÿ", generic: "Risperidone", category: "×¤×¡×™×›×•×–×”/×“×× ×¦×™×”", purpose: "×”×¤×¨×¢×•×ª ×”×ª× ×”×’×•×ª/×¤×¡×™×›×•×–×”" },
  { id: "med_17", name: "×§×•×•×˜×™××¤×™×Ÿ", generic: "Quetiapine", category: "×¤×¡×™×›×•×–×”/×“×× ×¦×™×”", purpose: "××™ ×©×§×˜ ×‘×“×× ×¦×™×”" },
  { id: "med_18", name: "×œ×‘×•×“×•×¤×”/×§×¨×‘×™×“×•×¤×”", generic: "Carbidopa/Levodopa", category: "×¤×¨×§×™× ×¡×•×Ÿ", purpose: "×ª×¡××™× ×™ ×¤×¨×§×™× ×¡×•×Ÿ" },
  { id: "med_19", name: "×œ×‘×˜×™×¨××¦×˜×", generic: "Levetiracetam", category: "××¤×™×œ×¤×¡×™×”", purpose: "×¤×¨×›×•×¡×™×" },
  { id: "med_20", name: "××˜×¤×•×¨××™×Ÿ (×’×œ×•×§×•×¤××’×³)", generic: "Metformin", category: "×¡×•×›×¨×ª", purpose: "×¡×•×›×¨×ª ×¡×•×’ 2" },
  { id: "med_21", name: "×’×œ×™××¤×™×¨×™×“ (×××¨×™×œ)", generic: "Glimepiride", category: "×¡×•×›×¨×ª", purpose: "×”×•×¨×“×ª ×¡×•×›×¨" },
  { id: "med_22", name: "×¡×™×˜×’×œ×™×¤×˜×™×Ÿ (×’×³× ×•×‘×™×™×”)", generic: "Sitagliptin", category: "×¡×•×›×¨×ª", purpose: "×”×•×¨×“×ª ×¡×•×›×¨" },
  { id: "med_23", name: "×œ×™× ×’×œ×™×¤×˜×™×Ÿ (×˜×¨×’×³× ×˜×”)", generic: "Linagliptin", category: "×¡×•×›×¨×ª", purpose: "×”×•×¨×“×ª ×¡×•×›×¨" },
  { id: "med_24", name: "×¡××’×œ×•×˜×™×“ (××•×–××¤×™×§)", generic: "Semaglutide", category: "×¡×•×›×¨×ª", purpose: "×”×•×¨×“×ª ×¡×•×›×¨/××©×§×œ" },
  { id: "med_25", name: "×œ×™×¨×’×œ×•×˜×™×“ (×•×™×§×˜×•×–×”)", generic: "Liraglutide", category: "×¡×•×›×¨×ª", purpose: "×”×•×¨×“×ª ×¡×•×›×¨/××©×§×œ" },
  { id: "med_26", name: "×“××¤××’×œ×™×¤×œ×•×–×™×Ÿ (×¤×•×¨×¡×™×’×”)", generic: "Dapagliflozin", category: "×¡×•×›×¨×ª", purpose: "×¡×•×›×¨×ª; ×’× ×œ×‘/×›×œ×™×”" },
  { id: "med_27", name: "×××¤××’×œ×™×¤×œ×•×–×™×Ÿ (×’×³×¨×“×™×× ×¡)", generic: "Empagliflozin", category: "×¡×•×›×¨×ª", purpose: "×¡×•×›×¨×ª; ×’× ×œ×‘/×›×œ×™×”" },
  { id: "med_28", name: "××™× ×¡×•×œ×™×Ÿ ×’×œ×¨×’×³×™×Ÿ (×œ× ×˜×•×¡)", generic: "Insulin glargine", category: "××™× ×¡×•×œ×™×Ÿ", purpose: "××™× ×¡×•×œ×™×Ÿ ×‘×–××œ×™" },
  { id: "med_29", name: "××™× ×¡×•×œ×™×Ÿ ××¡×¤×¨×˜ (× ×•×‘×•×¨×¤×™×“)", generic: "Insulin aspart", category: "××™× ×¡×•×œ×™×Ÿ", purpose: "×›×™×¡×•×™ ××¨×•×—×•×ª" },
  { id: "med_30", name: "××™× ×¡×•×œ×™×Ÿ ×“×’×œ×•×“×§ (×˜×¨×’×œ×•×“×§)", generic: "Insulin degludec", category: "××™× ×¡×•×œ×™×Ÿ", purpose: "××™× ×¡×•×œ×™×Ÿ ×‘×–××œ×™ ××¨×•×š" },
  { id: "med_31", name: "×××œ×•×“×™×¤×™×Ÿ (× ×•×¨×‘×¡×§)", generic: "Amlodipine", category: "×œ×—×¥ ×“×", purpose: "×™×ª×¨ ×œ×—×¥ ×“×/×ª×¢×•×§×”" },
  { id: "med_32", name: "×¨××™×¤×¨×™×œ (×˜×¨×™×˜×™×™×¡)", generic: "Ramipril", category: "×œ×—×¥ ×“×", purpose: "×™×ª×¨ ×œ×—×¥ ×“×/××™×´×¡ ×œ×‘" },
  { id: "med_33", name: "×× ××œ×¤×¨×™×œ", generic: "Enalapril", category: "×œ×—×¥ ×“×", purpose: "×™×ª×¨ ×œ×—×¥ ×“×/××™×´×¡ ×œ×‘" },
  { id: "med_34", name: "×œ×•×¡×¨×˜×Ÿ (××•×§×¡××¨)", generic: "Losartan", category: "×œ×—×¥ ×“×", purpose: "×™×ª×¨ ×œ×—×¥ ×“×" },
  { id: "med_35", name: "×•×œ×¡×¨×˜×Ÿ (×“×™×•×‘×Ÿ)", generic: "Valsartan", category: "×œ×—×¥ ×“×", purpose: "×™×ª×¨ ×œ×—×¥ ×“×/××™×´×¡ ×œ×‘" },
  { id: "med_36", name: "××˜×•×¤×¨×•×œ×•×œ", generic: "Metoprolol", category: "×œ×—×¥ ×“×", purpose: "×™×ª×¨ ×œ×—×¥ ×“×/×ª×¢×•×§×”" },
  { id: "med_37", name: "×‘×™×¡×•×¤×¨×•×œ×•×œ (×§×•× ×§×•×¨)", generic: "Bisoprolol", category: "×œ×—×¥ ×“×", purpose: "×™×ª×¨ ×œ×—×¥ ×“×/××™×´×¡ ×œ×‘" },
  { id: "med_38", name: "×”×™×“×¨×•×›×œ×•×¨×•×ª×™××–×™×“", generic: "Hydrochlorothiazide", category: "×œ×—×¥ ×“× â€“ ××©×ª× ×™×", purpose: "×”×•×¨×“×ª ×œ×—×¥ ×“×" },
  { id: "med_39", name: "×¤×•×¨×•×¡××™×“ (×¤×•×¡×™×“)", generic: "Furosemide", category: "××™×´×¡ ×œ×‘/×‘×¦×§×•×ª", purpose: "×‘×¦×§×•×ª/××™Ö¾×¡×¤×™×§×ª ×œ×‘" },
  { id: "med_40", name: "×¡×¤×™×¨×•× ×•×œ×§×˜×•×Ÿ (××œ×“×§×˜×•×Ÿ)", generic: "Spironolactone", category: "××™×´×¡ ×œ×‘", purpose: "××™Ö¾×¡×¤×™×§×ª ×œ×‘" },
  { id: "med_41", name: "×× ×˜×¨×¡×˜×•", generic: "Sacubitril/Valsartan", category: "××™×´×¡ ×œ×‘", purpose: "××™Ö¾×¡×¤×™×§×ª ×œ×‘ ×¢× EF ×™×¨×•×“" },
  { id: "med_42", name: "×“×™×’×•×§×¡×™×Ÿ", generic: "Digoxin", category: "××™×´×¡ ×œ×‘/×¤×¨×¤×•×¨", purpose: "×©×œ×™×˜×” ×‘×§×¦×‘/××™×´×¡ ×œ×‘" },
  { id: "med_43", name: "××˜×•×¨×‘×¡×˜×˜×™×Ÿ (×œ×™×¤×™×˜×•×¨)", generic: "Atorvastatin", category: "×›×•×œ×¡×˜×¨×•×œ", purpose: "×”×•×¨×“×ª LDL" },
  { id: "med_44", name: "×¨×•×–×•×‘×¡×˜×˜×™×Ÿ (×§×¨×¡×˜×•×¨)", generic: "Rosuvastatin", category: "×›×•×œ×¡×˜×¨×•×œ", purpose: "×”×•×¨×“×ª LDL" },
  { id: "med_45", name: "××–×˜×™××™×‘ (××™×–×˜×¨×•×œ)", generic: "Ezetimibe", category: "×›×•×œ×¡×˜×¨×•×œ", purpose: "×”×¤×—×ª×ª ×¡×¤×™×’×ª ×›×•×œ×¡×˜×¨×•×œ" },
  { id: "med_46", name: "×•×•×¨×¤×¨×™×Ÿ (×§×•××“×™×Ÿ)", generic: "Warfarin", category: "× ×•×’×“×™ ×§×¨×™×©×”", purpose: "×“×™×œ×•×œ ×“×" },
  { id: "med_47", name: "××¤×™×§×¡×‘××Ÿ", generic: "Apixaban", category: "× ×•×’×“×™ ×§×¨×™×©×”", purpose: "×“×™×œ×•×œ ×“×" },
  { id: "med_48", name: "×¨×™×‘×¨×•×§×¡×‘××Ÿ (×§×¡×¨×œ×˜×•)", generic: "Rivaroxaban", category: "× ×•×’×“×™ ×§×¨×™×©×”", purpose: "×“×™×œ×•×œ ×“×" },
  { id: "med_49", name: "××¡×¤×™×¨×™×Ÿ", generic: "Aspirin", category: "× ×•×’×“×™ ×˜×¡×™×•×ª", purpose: "×× ×™×¢×” ×©× ×™×•× ×™×ª" },
  { id: "med_50", name: "×§×œ×•×¤×™×“×•×’×¨×œ (×¤×œ××‘×™×§×¡)", generic: "Clopidogrel", category: "× ×•×’×“×™ ×˜×¡×™×•×ª", purpose: "×× ×™×¢×” ×˜×¡×™×ª" },
  { id: "med_51", name: "××§××•×œ (×¤×¨×¦×˜××•×œ)", generic: "Paracetamol", category: "×›××‘", purpose: "×›××‘/×—×•×" },
  { id: "med_52", name: "××™×‘×•×¤×¨×•×¤×Ÿ", generic: "Ibuprofen", category: "×›××‘/×“×œ×§×ª", purpose: "×›××‘/×“×œ×§×ª" },
  { id: "med_53", name: "×’×‘××¤× ×˜×™×Ÿ", generic: "Gabapentin", category: "×›××‘ × ×•×™×¨×•×¤×ª×™", purpose: "×›××‘ × ×•×™×¨×•×¤×ª×™" },
  { id: "med_54", name: "×¤×¨×’××‘××œ×™×Ÿ (×œ×™×¨×™×§×”)", generic: "Pregabalin", category: "×›××‘ × ×•×™×¨×•×¤×ª×™", purpose: "×›××‘ × ×•×™×¨×•×¤×ª×™" },
  { id: "med_55", name: "××•××¤×¨×–×•×œ", generic: "Omeprazole", category: "×§×™×‘×”/×¨×¤×œ×•×§×¡", purpose: "×¨×¤×œ×•×§×¡/×›×™×‘" },
  { id: "med_56", name: "×¤× ×˜×•×¤×¨×–×•×œ", generic: "Pantoprazole", category: "×§×™×‘×”/×¨×¤×œ×•×§×¡", purpose: "×¨×¤×œ×•×§×¡/×›×™×‘" },
  { id: "med_57", name: "×œ×§×˜×•×œ×•×– (××‘×™×œ××§)", generic: "Lactulose", category: "×¢×¦×™×¨×•×ª", purpose: "×¢×¦×™×¨×•×ª" },
  { id: "med_58", name: "×¤×’×œ×§×¡", generic: "PEG", category: "×¢×¦×™×¨×•×ª", purpose: "×¢×¦×™×¨×•×ª" },
  { id: "med_59", name: "××œ×˜×¨×•×§×¡×™×Ÿ", generic: "Levothyroxine", category: "×‘×œ×•×˜×ª ×”×ª×¨×™×¡", purpose: "×ª×ªÖ¾×¤×¢×™×œ×•×ª ×ª×¨×™×¡" },
  { id: "med_60", name: "×˜××¡×•×œ×•×¡×™×Ÿ", generic: "Tamsulosin", category: "×¢×¨××•× ×™×ª", purpose: "×©×™×¤×•×¨ ×–×¨×™××ª ×©×ª×Ÿ" },
  { id: "med_61", name: "×¤×™× ×¡×˜×¨×™×“", generic: "Finasteride", category: "×¢×¨××•× ×™×ª", purpose: "×”×§×˜× ×ª × ×¤×— ×¢×¨××•× ×™×ª" },
  { id: "med_62", name: "××œ× ×“×¨×•× ×˜", generic: "Alendronate", category: "××•×¡×˜××•×¤×•×¨×•×–×™×¡", purpose: "×—×™×–×•×§ ×¢×¦×" },
  { id: "med_63", name: "×“× ×•×¡×•×××‘", generic: "Denosumab", category: "××•×¡×˜××•×¤×•×¨×•×–×™×¡", purpose: "×˜×™×¤×•×œ ×‘××•×¡×˜××•×¤×•×¨×•×–×™×¡" },
  { id: "med_64", name: "×¡×œ×‘×•×˜××•×œ (×•× ×˜×•×œ×™×Ÿ)", generic: "Salbutamol", category: "××¡×ª××”/COPD", purpose: "××¨×—×™×‘ ×¡××¤×•× ×•×ª" },
  { id: "med_65", name: "×˜×™×•×˜×¨×•×¤×™×•×", generic: "Tiotropium", category: "COPD", purpose: "××¨×—×™×‘ ×¡××¤×•× ×•×ª ××¨×•×š" },
  { id: "med_66", name: "×œ×˜× ×•×¤×¨×•×¡×˜", generic: "Latanoprost", category: "×’×œ××•×§×•××”", purpose: "×”×•×¨×“×ª ×œ×—×¥ ×ª×•×šÖ¾×¢×™× ×™" },
  { id: "med_67", name: "×˜×™××•×œ×•×œ", generic: "Timolol", category: "×’×œ××•×§×•××”", purpose: "×”×•×¨×“×ª ×œ×—×¥ ×ª×•×šÖ¾×¢×™× ×™" },
  { id: "med_68", name: "××œ×•×¤×•×¨×™× ×•×œ (×–×™×œ×•×¤×¨×™×)", generic: "Allopurinol", category: "×’××•×˜", purpose: "×”×•×¨×“×ª ×—×•××¦×” ××•×¨×™×ª" },
  { id: "med_69", name: "×§×•×œ×›×™×¦×™×Ÿ", generic: "Colchicine", category: "×’××•×˜", purpose: "×”×ª×§×£ ×’××•×˜" },
  { id: "med_70", name: "×××™×•×“×¨×•×Ÿ", generic: "Amiodarone", category: "×”×¤×¨×¢×•×ª ×§×¦×‘", purpose: "×”×¤×¨×¢×•×ª ×§×¦×‘" },
  { id: "med_71", name: "×‘×¨×–×œ ×¤×•××™", generic: "Ferrous salts", category: "×× ××™×”", purpose: "×—×¡×¨ ×‘×¨×–×œ" },
  { id: "med_72", name: "××œ×¤×-D3", generic: "Alfacalcidol", category: "×›×œ×™×•×ª/×•×™×˜××™×Ÿ D", purpose: "×”×¤×¨×¢×•×ª ××˜×‘×•×œ×™×–× ×¢×¦×" },
  // ××œ×¦×”×™×™××¨ â€“ ××©× ×” ××”×œ×š
  { id: "med_73", name: "×œ×§× ××‘/×œ×§××‘×™ (Leqembi)", generic: "Lecanemab", category: "××œ×¦×”×™×™××¨ â€“ × ×•×’×“× ×™×", purpose: "××œ×¦×”×™×™××¨ ×‘×©×œ×‘ ××•×§×“×, ×¤×™× ×•×™ ×¢××™×œ×•××™×“" },
  { id: "med_74", name: "×“×•× × ××‘/×§×™×¡×•× ×œ×” (Kisunla)", generic: "Donanemab", category: "××œ×¦×”×™×™××¨ â€“ × ×•×’×“× ×™×", purpose: "××œ×¦×”×™×™××¨ ××•×§×“×" },
  // ×“×™×›××•×Ÿ/×—×¨×“×” â€“ × ×•×¡×¤×™×
  { id: "med_75", name: "×××™×˜×¨×™×¤×˜×™×œ×™×Ÿ (××œ×˜×¨×•×œ)", generic: "Amitriptyline", category: "×“×™×›××•×Ÿ/×›××‘ â€“ TCA", purpose: "×“×™×›××•×Ÿ/×›××‘ × ×•×™×¨×•×¤×ª×™; ×–×”×™×¨×•×ª ×‘×§×©×™×©×™×" },
  // ×—×¨×“×”/×©×™× ×” â€“ ×‘× ×–×•×“×™××–×¤×™× ×™×
  { id: "med_76", name: "×“×™××–×¤×× (×•××œ×™×•×)", generic: "Diazepam", category: "×—×¨×“×”/×©×™× ×”", purpose: "×—×¨×“×”/×¢×•×•×™×ª×•×ª; ×–×”×™×¨×•×ª ×‘×§×©×™×©×™×" },
  { id: "med_77", name: "× ×•××‘×•×Ÿ (× ×™×˜×¨××–×¤××)", generic: "Nitrazepam", category: "×©×™× ×”", purpose: "× ×“×•×“×™ ×©×™× ×” ×§×¦×¨×™Ö¾×˜×•×•×—" },
  // ××¦×‘ ×¨×•×—
  { id: "med_78", name: "×œ×™×ª×™×•×", generic: "Lithium", category: "××¦×‘ ×¨×•×—", purpose: "×‘×™×¤×•×œ×¨/××× ×™×”; ×“×•×¨×© × ×™×˜×•×¨ ×¦××•×“" },
  // ××¤×™×œ×¤×¡×™×”
  { id: "med_79", name: "×¤× ×™×˜×•××™×Ÿ", generic: "Phenytoin", category: "××¤×™×œ×¤×¡×™×”", purpose: "×¤×¨×›×•×¡×™×; ×“×•×¨×© ××¢×§×‘ ×¨××•×ª" },
  // ×¡×•×›×¨×ª â€“ × ×•×¡×¤×™×
  { id: "med_80", name: "×’×œ×™×¤×™×–×™×“", generic: "Glipizide", category: "×¡×•×›×¨×ª", purpose: "×”×•×¨×“×ª ×¡×•×›×¨; ×¡×™×›×•×Ÿ ×”×™×¤×•×’×œ×™×§××™×”" },
  { id: "med_81", name: "×’×œ×™×‘× ×§×œ×××™×“ (×’×œ×•×‘×Ÿ/×“××•× ×™×œ)", generic: "Glibenclamide", category: "×¡×•×›×¨×ª â€“ ×–×”×™×¨×•×ª", purpose: "×”×•×¨×“×ª ×¡×•×›×¨; ×¡×™×›×•×Ÿ ×’×‘×•×” ×œ×”×™×¤×•×’×œ×™×§××™×” ×‘×§×©×™×©×™×" },
  { id: "med_82", name: "×•×™×œ×“×’×œ×™×¤×˜×™×Ÿ (×’×œ×‘×•×¡)", generic: "Vildagliptin", category: "×¡×•×›×¨×ª â€“ DPP4", purpose: "×”×•×¨×“×ª ×¡×•×›×¨" },
  { id: "med_83", name: "×¡×§×¡×’×œ×™×¤×˜×™×Ÿ (××•× ×’×œ×™×–×”)", generic: "Saxagliptin", category: "×¡×•×›×¨×ª â€“ DPP4", purpose: "×”×•×¨×“×ª ×¡×•×›×¨" },
  { id: "med_84", name: "×“×•×œ×’×œ×•×˜×™×“ (×˜×¨×•×œ×™×¡×™×˜×™)", generic: "Dulaglutide", category: "×¡×•×›×¨×ª â€“ GLP1", purpose: "×”×•×¨×“×ª ×¡×•×›×¨" },
  { id: "med_85", name: "×¨×¤××’×œ×™× ×™×“ (× ×•×‘×•× ×•×¨×)", generic: "Repaglinide", category: "×¡×•×›×¨×ª", purpose: "×”×•×¨×“×ª ×¡×•×›×¨ ×¡×‘×™×‘ ××¨×•×—×•×ª" },
  { id: "med_86", name: "××§×¨×‘×•×– (×¤×¨× ×“×–)", generic: "Acarbose", category: "×¡×•×›×¨×ª", purpose: "×”×•×¨×“×ª ×¡×•×›×¨ ××—×¨×™ ××¨×•×—×•×ª" },
  { id: "med_87", name: "×¤×™×•×’×œ×™×˜×–×•×Ÿ (××§×˜×•×¡)", generic: "Pioglitazone", category: "×¡×•×›×¨×ª â€“ TZD", purpose: "×”×•×¨×“×ª ×¡×•×›×¨; ×–×”×™×¨×•×ª ×‘××™×´×¡ ×œ×‘" },
  // ××™× ×¡×•×œ×™×Ÿ â€“ × ×•×¡×¤×™×
  { id: "med_88", name: "××™× ×¡×•×œ×™×Ÿ ×œ×™×¡×¤×¨×• (×”×•×××œ×•×’)", generic: "Insulin lispro", category: "××™× ×¡×•×œ×™×Ÿ â€“ ××”×™×¨", purpose: "×›×™×¡×•×™ ××¨×•×—×•×ª" },
  { id: "med_89", name: "××™× ×¡×•×œ×™×Ÿ ×’×œ×•×œ×™×–×™×Ÿ (××¤×™×“×¨×”)", generic: "Insulin glulisine", category: "××™× ×¡×•×œ×™×Ÿ â€“ ××”×™×¨", purpose: "×›×™×¡×•×™ ××¨×•×—×•×ª" },
  { id: "med_90", name: "××™× ×¡×•×œ×™×Ÿ ×¨×’×•×œ×¨×™ (××§×˜×¨××¤×™×“)", generic: "Regular insulin", category: "××™× ×¡×•×œ×™×Ÿ â€“ ×§×¦×¨", purpose: "×›×™×¡×•×™ ××¨×•×—×•×ª/×ª×™×§×•× ×™×" },
  { id: "med_91", name: "NPH ××™× ×¡×•×œ×™×Ÿ (×”×•××•×œ×™×Ÿ N)", generic: "NPH insulin", category: "××™× ×¡×•×œ×™×Ÿ â€“ ×‘×™× ×•× ×™", purpose: "××™× ×¡×•×œ×™×Ÿ ×‘×–××œ×™ ×‘×™× ×™×™×" },
  { id: "med_92", name: "× ×•×‘×•××™×§×¡ (××™× ×¡×•×œ×™×Ÿ ××¢×•×¨×‘)", generic: "Mixed insulin aspart", category: "××™× ×¡×•×œ×™×Ÿ â€“ ××¢×•×¨×‘", purpose: "×›×™×¡×•×™ ×‘×–××œ×™+××¨×•×—×•×ª" },
  // ×œ×—×¥ ×“× â€“ × ×•×¡×¤×™×
  { id: "med_93", name: "×›×œ×•×¨×ª×œ×™×“×•×Ÿ", generic: "Chlorthalidone", category: "×œ×—×¥ ×“× â€“ ××©×ª× ×™×", purpose: "××©×ª×Ÿ ×ª×™××–×™×“×™; ×™×¢×™×œ ×œ××•×¨×š ×–××Ÿ" },
  { id: "med_94", name: "×œ×™×¡×™× ×•×¤×¨×™×œ", generic: "Lisinopril", category: "×œ×—×¥ ×“× â€“ ACEI", purpose: "×™×ª×¨ ×œ×—×¥ ×“×/××™×´×¡ ×œ×‘" },
  { id: "med_95", name: "×§× ×“×¡×¨×˜×Ÿ (××˜×§× ×“)", generic: "Candesartan", category: "×œ×—×¥ ×“× â€“ ARB", purpose: "×™×ª×¨ ×œ×—×¥ ×“×/××™×´×¡ ×œ×‘" },
  { id: "med_96", name: "××˜× ×•×œ×•×œ (× ×•×¨××™×˜×Ÿ)", generic: "Atenolol", category: "×œ×—×¥ ×“× â€“ ×—×•×¡××™ ×‘×˜×", purpose: "×™×ª×¨ ×œ×—×¥ ×“×" },
  { id: "med_97", name: "× ×™×¤×“×™×¤×™×Ÿ", generic: "Nifedipine", category: "×œ×—×¥ ×“× â€“ ×—×•×¡××™ ×¡×™×“×Ÿ", purpose: "×™×ª×¨ ×œ×—×¥ ×“×" },
  { id: "med_98", name: "×“×™×œ×˜×™××–×", generic: "Diltiazem", category: "×”×¤×¨×¢×•×ª ×§×¦×‘/×œ×—×¥ ×“×", purpose: "×¤×¨×¤×•×¨/×œ×—×¥ ×“×/×ª×¢×•×§×”" },
  { id: "med_99", name: "×•×¨×¤××™×œ", generic: "Verapamil", category: "×”×¤×¨×¢×•×ª ×§×¦×‘/×œ×—×¥ ×“×", purpose: "×”×¤×¨×¢×•×ª ×§×¦×‘/×œ×—×¥ ×“×; ×–×”×™×¨×•×ª ×‘×¢×¦×™×¨×•×ª" },
  { id: "med_100", name: "×“×•×§×¡×–×•×¡×™×Ÿ (×§×¨×“×•×¨×œ)", generic: "Doxazosin", category: "×œ×—×¥ ×“×/×¢×¨××•× ×™×ª", purpose: "×™×ª×¨ ×œ×—×¥ ×“×/×¢×¨××•× ×™×ª; ×¡×™×›×•×Ÿ ×ª×ªÖ¾×œ×´×“" },
  { id: "med_101", name: "×¤×œ×•×“×™×¤×™×Ÿ", generic: "Felodipine", category: "×œ×—×¥ ×“× â€“ ×—×•×¡××™ ×¡×™×“×Ÿ", purpose: "×™×ª×¨ ×œ×—×¥ ×“×" },
  // ××™×´×¡ ×œ×‘ â€“ × ×•×¡×¤×™×
  { id: "med_102", name: "×˜×•×¨×¡××™×“", generic: "Torsemide", category: "××™×´×¡ ×œ×‘/×‘×¦×§×•×ª", purpose: "×‘×¦×§×•×ª/××™Ö¾×¡×¤×™×§×ª ×œ×‘; ×—×œ×•×¤×” ×œ×¤×•×¨×•×¡××™×“" },
  { id: "med_103", name: "×‘×•××˜× ×™×“", generic: "Bumetanide", category: "××™×´×¡ ×œ×‘/×‘×¦×§×•×ª", purpose: "×‘×¦×§×•×ª/××™Ö¾×¡×¤×™×§×ª ×œ×‘; ×—×œ×•×¤×” ×œ×¤×•×¨×•×¡××™×“" },
  { id: "med_104", name: "××¤×œ×¨× ×•×Ÿ (××™× ×¡×¤×™×¨×”)", generic: "Eplerenone", category: "××™×´×¡ ×œ×‘", purpose: "××™Ö¾×¡×¤×™×§×ª ×œ×‘; ×¤×—×•×ª ×ª×´×œ ×”×•×¨××•× ×œ×™×•×ª" },
  { id: "med_105", name: "×××™×œ×•×¨×™×“", generic: "Amiloride", category: "××©×ª× ×™× ××©××¨×™ ××©×œ×’×Ÿ", purpose: "×× ×™×¢×ª ×”×™×¤×•×§×œ××™×”" },
  { id: "med_106", name: "×§×¨×‘×™×“×™×œ×•×œ", generic: "Carvedilol", category: "××™×´×¡ ×œ×‘ â€“ ×—×•×¡××™ ×‘×˜×", purpose: "××™×´×¡ ×œ×‘/××—×¨×™ ××•×˜×/×œ×—×¥ ×“×" },
  { id: "med_107", name: "× ×‘×™×•×•×œ×•×œ", generic: "Nebivolol", category: "×œ×—×¥ ×“× â€“ ×—×•×¡××™ ×‘×˜×", purpose: "×™×ª×¨ ×œ×—×¥ ×“×; ××•×¢×“×£ ×‘×—×œ×§ ××”×§×©×™×©×™×" },
  { id: "med_108", name: "×§×•×¨××œ×Ÿ", generic: "Ivabradine", category: "××™×´×¡ ×œ×‘", purpose: "××™×´×¡ ×œ×‘ ×¢× ×“×•×¤×§ ×’×‘×•×” ×‘×¡×™× ×•×¡" },
  { id: "med_109", name: "×”×™×“×¨×œ××–×™×Ÿ", generic: "Hydralazine", category: "×œ×—×¥ ×“×/××™×´×¡ ×œ×‘", purpose: "×™×ª×¨ ×œ×—×¥ ×“× ×¢××™×“/××™×´×¡ ×œ×‘" },
  { id: "med_110", name: "××™× ×•×§×¡×™×“×™×œ", generic: "Minoxidil", category: "×œ×—×¥ ×“×", purpose: "×™×ª×¨ ×œ×—×¥ ×“× ×¢××™×“" },
  // ×ª×¢×•×§×ª ×—×–×”
  { id: "med_111", name: "× ×™×˜×¨×•×’×œ×™×¦×¨×™×Ÿ (×¡×¤×¨×™×™/×ª×ªÖ¾×œ×©×•×Ÿ)", generic: "Nitroglycerin", category: "×ª×¢×•×§×ª ×—×–×”", purpose: "×”×§×œ×” ××”×™×¨×” ×‘×›××‘×™ ×—×–×” (×× ×’×™× ×”)" },
  { id: "med_112", name: "××™×–×•×¡×•×¨×‘×™×“ (××•× ×•× ×™×˜×¨×˜/×“×™× ×™×˜×¨×˜)", generic: "Isosorbide", category: "×ª×¢×•×§×ª ×—×–×”", purpose: "×× ×™×¢×ª ×× ×’×™× ×”; ×–×”×™×¨×•×ª ×™×¨×™×“×ª ×œ×´×“" },
  // ×›×•×œ×¡×˜×¨×•×œ â€“ × ×•×¡×¤×™×
  { id: "med_113", name: "×¡×™××‘×¡×˜×˜×™×Ÿ", generic: "Simvastatin", category: "×›×•×œ×¡×˜×¨×•×œ", purpose: "×”×•×¨×“×ª LDL" },
  { id: "med_114", name: "×¤×¨××‘×¡×˜×˜×™×Ÿ", generic: "Pravastatin", category: "×›×•×œ×¡×˜×¨×•×œ", purpose: "×”×•×¨×“×ª LDL; ×¤×—×•×ª ××™× ×˜×¨××§×¦×™×•×ª" },
  { id: "med_115", name: "×¤× ×•×¤×™×‘×¨××˜ / ×‘×–××¤×™×‘×¨××˜ (×‘×–××œ×™×¤)", generic: "Fenofibrate/Bezafibrate", category: "×›×•×œ×¡×˜×¨×•×œ â€“ ×¤×™×‘×¨××˜×™×", purpose: "×˜×¨×™×’×œ×™×¦×¨×™×“×™× ×’×‘×•×”×™×" },
  { id: "med_116", name: "××œ×™×¨×•×§×•×××‘ (×¤×¨××œ×•×× ×˜)", generic: "Alirocumab", category: "×›×•×œ×¡×˜×¨×•×œ â€“ PCSK9", purpose: "×”×•×¨×“×ª LDL ××©××¢×•×ª×™×ª (×–×¨×™×§×•×ª)" },
  { id: "med_117", name: "××‘×•×œ×•×§×•×××‘", generic: "Evolocumab", category: "×›×•×œ×¡×˜×¨×•×œ â€“ PCSK9", purpose: "×”×•×¨×“×ª LDL ××©××¢×•×ª×™×ª (×–×¨×™×§×•×ª)" },
  // × ×•×’×“×™ ×§×¨×™×©×” â€“ × ×•×¡×¤×™×
  { id: "med_118", name: "×“×‘×™×’×˜×¨××Ÿ (×¤×¨×“×§×¡×”)", generic: "Dabigatran", category: "× ×•×’×“×™ ×§×¨×™×©×” â€“ DOAC", purpose: "×“×™×œ×•×œ ×“×; ×ª×œ×•×™ ×ª×¤×§×•×“ ×›×œ×™×™×ª×™" },
  // ×›×œ×™×•×ª
  { id: "med_119", name: "×¡×‘×œ×××¨ (×¨× ×•×•×œ×”)", generic: "Sevelamer", category: "×›×œ×™×•×ª â€“ ×§×•×©×¨×™ ×–×¨×—×Ÿ", purpose: "×”×™×¤×¨×¤×•×¡×¤×˜××™×” ×‘Ö¾CKD/×“×™××œ×™×–×”" },
  { id: "med_120", name: "×œ× ×ª× ×•× ×§×¨×‘×•× ×˜ (×¤×•×¡×¨× ×•×œ)", generic: "Lanthanum carbonate", category: "×›×œ×™×•×ª â€“ ×§×•×©×¨×™ ×–×¨×—×Ÿ", purpose: "×”×™×¤×¨×¤×•×¡×¤×˜××™×” ×‘Ö¾CKD" },
  { id: "med_121", name: "×§×œ×¦×™×•× ××¦×˜×˜ (×¤×•×¡×œ×•)", generic: "Calcium acetate", category: "×›×œ×™×•×ª â€“ ×§×•×©×¨×™ ×–×¨×—×Ÿ", purpose: "×”×™×¤×¨×¤×•×¡×¤×˜××™×” ×‘Ö¾CKD" },
  { id: "med_122", name: "×§×œ×¦×™×•× ×§×¨×‘×•× ×˜", generic: "Calcium carbonate", category: "×›×œ×™×•×ª", purpose: "×§×•×©×¨ ×–×¨×—×Ÿ/×¡×™×“×Ÿ" },
  { id: "med_123", name: "×§×™×™××§×¡×œ××˜", generic: "Sodium polystyrene sulfonate", category: "×›×œ×™×•×ª â€“ ××™×–×•×Ÿ ××©×œ×’×Ÿ", purpose: "×”×™×¤×¨×§×œ××™×”" },
  { id: "med_124", name: "×¤×˜×™×¨×•××¨ (Veltassa)", generic: "Patiromer", category: "×›×œ×™×•×ª â€“ ××™×–×•×Ÿ ××©×œ×’×Ÿ", purpose: "×”×™×¤×¨×§×œ××™×” ×›×¨×•× ×™×ª" },
  { id: "med_125", name: "×œ×•×§×œ××”", generic: "Sodium zirconium cyclosilicate", category: "×›×œ×™×•×ª â€“ ××™×–×•×Ÿ ××©×œ×’×Ÿ", purpose: "×”×™×¤×¨×§×œ××™×”" },
  { id: "med_126", name: "×¤××¨×™×§×œ×¦×™×˜×•×œ (×–××¤×œ×¨)", generic: "Paricalcitol", category: "×›×œ×™×•×ª â€“ ×•×™×˜××™×Ÿ D", purpose: "×”×™×¤×¨×¤×¨××ª×™×•××™×“×™×–× ××©× ×™ ×‘Ö¾CKD" },
  { id: "med_127", name: "×¡×™× ×§×œ×¦×˜ (××™××¤×¨×”)", generic: "Cinacalcet", category: "×›×œ×™×•×ª â€“ PTH", purpose: "×”×•×¨×“×ª PTH ×‘×”×™×¤×¨×¤×¨××ª×™×•××™×“×™×–× ××©× ×™" },
  // ×× ××™×” â€“ ESA
  { id: "med_128", name: "××¤×•××˜×™×Ÿ ××œ×¤× (××¤×¨×§×¡)", generic: "Epoetin alfa", category: "×× ××™×” â€“ ESA", purpose: "×˜×™×¤×•×œ ×‘×× ××™×” ×¢×œ ×¨×§×¢ CKD" },
  { id: "med_129", name: "×“××¨×‘×¤×•××˜×™×Ÿ (××¨× ×¡×¤)", generic: "Darbepoetin alfa", category: "×× ××™×” â€“ ESA", purpose: "×˜×™×¤×•×œ ×‘×× ××™×” ×¢×œ ×¨×§×¢ CKD" },
  // ×‘×¨×–×œ â€“ IV
  { id: "med_130", name: "×•× ×•×¤×¨ (×‘×¨×–×œ ×¡×•×›×¨×•×–)", generic: "Iron sucrose", category: "×‘×¨×–×œ â€“ IV", purpose: "×—×¡×¨ ×‘×¨×–×œ ×›×©×¤×•××™ ×œ× ××ª××™×" },
  { id: "med_131", name: "×¤×¨×™× ×’×³×§×˜", generic: "Ferric carboxymaltose", category: "×‘×¨×–×œ â€“ IV", purpose: "×—×¡×¨ ×‘×¨×–×œ (××ª×Ÿ ×•×¨×™×“×™)" },
  // ×”×©×ª×œ×•×ª
  { id: "med_132", name: "×¤×¨×“× ×™×–×•×Ÿ", generic: "Prednisone", category: "×”×©×ª×œ×•×ª/×“×œ×§×ª", purpose: "×“×™×›×•×™ ×—×™×¡×•× ×™/×“×œ×§×ª" },
  { id: "med_133", name: "×˜×§×¨×•×œ×™××•×¡ (×¤×¨×•×’×¨×£)", generic: "Tacrolimus", category: "×”×©×ª×œ×•×ª", purpose: "×× ×™×¢×ª ×“×—×™×™×ª ×©×ª×œ" },
  { id: "med_134", name: "×¦×™×§×œ×•×¡×¤×•×¨×™×Ÿ", generic: "Cyclosporine", category: "×”×©×ª×œ×•×ª", purpose: "×× ×™×¢×ª ×“×—×™×™×ª ×©×ª×œ" },
  { id: "med_135", name: "××™×§×•×¤× ×•×œ×˜ (×¡×œ×¡×¤×˜/××™×¤×•×¨×˜×™×§)", generic: "Mycophenolate", category: "×”×©×ª×œ×•×ª", purpose: "×× ×™×¢×ª ×“×—×™×™×ª ×©×ª×œ" },
  { id: "med_136", name: "×¡×™×¨×•×œ×™××•×¡ (×¨×¤××™×•×Ÿ)", generic: "Sirolimus", category: "×”×©×ª×œ×•×ª", purpose: "×× ×™×¢×ª ×“×—×™×™×ª ×©×ª×œ" },
  // ×›××‘ â€“ × ×•×¡×¤×™×
  { id: "med_137", name: "× ××¤×¨×•×§×¡×Ÿ/×“×™×§×œ×•×¤× ×§", generic: "Naproxen/Diclofenac", category: "×›××‘/×“×œ×§×ª â€“ NSAIDs", purpose: "×›××‘/×“×œ×§×ª; ×–×”×™×¨×•×ª ×›×œ×™×”/×“×™××•×" },
  { id: "med_138", name: "××•×¨×¤×™×Ÿ", generic: "Morphine", category: "×›××‘ â€“ ××•×¤×™×•××™×“×™×", purpose: "×›××‘ ×—×–×§; ×¡×™×›×•×Ÿ × ×¤×™×œ×•×ª/×‘×œ×‘×•×œ" },
  { id: "med_139", name: "××•×§×¡×™×§×•×“×•×Ÿ/×¤× ×˜× ×™×œ/×‘×•×¤×¨× ×•×¨×¤×™×Ÿ", generic: "Oxycodone/Fentanyl/Buprenorphine", category: "×›××‘ â€“ ××•×¤×™×•××™×“×™×", purpose: "×›××‘ ×—×–×§ (×‘×”×ª×××”)" },
  // ×’××•×˜ â€“ × ×•×¡×£
  { id: "med_140", name: "×¤×‘×•×§×¡×•×¡×˜×˜ (×¤×‘×•×¨×™×§)", generic: "Febuxostat", category: "×’××•×˜", purpose: "×”×•×¨×“×ª ×—×•××¦×” ××•×¨×™×ª; ×—×œ×•×¤×” ×œ××œ×•×¤×•×¨×™× ×•×œ" },
  // ×¢×™×›×•×œ â€“ × ×•×¡×¤×™×
  { id: "med_141", name: "×¤××•×˜×™×“×™×Ÿ", generic: "Famotidine", category: "×§×™×‘×” â€“ H2", purpose: "×¦×¨×‘×ª/×›×™×‘; ×—×œ×•×¤×” ×œ-PPI" },
  { id: "med_142", name: "×‘×™×¡×§×•×“×™×œ (×œ×§×¡×“×™×Ÿ)", generic: "Bisacodyl", category: "×¢×¦×™×¨×•×ª", purpose: "×¢×¦×™×¨×•×ª" },
  { id: "med_143", name: "×¡× ×”", generic: "Senna", category: "×¢×¦×™×¨×•×ª", purpose: "×¢×¦×™×¨×•×ª" },
  // ×©×œ×¤×•×—×™×ª
  { id: "med_144", name: "××•×§×¡×™×‘×•×˜×™× ×™×Ÿ", generic: "Oxybutynin", category: "×©×œ×¤×•×—×™×ª ×¨×’×™×–×”", purpose: "×“×—×™×¤×•×ª/×“×œ×™×¤×•×ª; ×–×”×™×¨×•×ª ×‘×§×©×™×©×™×" },
  { id: "med_145", name: "××™×¨×‘×’×¨×•×Ÿ", generic: "Mirabegron", category: "×©×œ×¤×•×—×™×ª ×¨×’×™×–×”", purpose: "×—×œ×•×¤×” ×¤×—×•×ª ×× ×˜×™×›×•×œ×™× ×¨×’×™×ª" },
  // ××•×¡×˜××•×¤×•×¨×•×–×™×¡ â€“ × ×•×¡×£
  { id: "med_146", name: "×¨×™×–×“×¨×•× ×˜", generic: "Risedronate", category: "××•×¡×˜××•×¤×•×¨×•×–×™×¡", purpose: "×—×™×–×•×§ ×¢×¦× ×•×× ×™×¢×ª ×©×‘×¨×™×" },
  // ×× ×˜×™×‘×™×•×˜×™×§×”
  { id: "med_147", name: "×××•×§×¡×™×¦×™×œ×™×Ÿ", generic: "Amoxicillin", category: "×× ×˜×™×‘×™×•×˜×™×§×”", purpose: "×–×™×”×•××™× ×©×›×™×—×™×" },
  { id: "med_148", name: "×¦×¤×œ×›×¡×™×Ÿ", generic: "Cephalexin", category: "×× ×˜×™×‘×™×•×˜×™×§×”", purpose: "×–×™×”×•××™× ×©×›×™×—×™×" },
  { id: "med_149", name: "×“×•×§×¡×™×¦×™×§×œ×™×Ÿ", generic: "Doxycycline", category: "×× ×˜×™×‘×™×•×˜×™×§×”", purpose: "×–×™×”×•××™× ×©×›×™×—×™×" },
  { id: "med_150", name: "× ×™×˜×¨×•×¤×•×¨× ×˜×•××™×Ÿ", generic: "Nitrofurantoin", category: "×× ×˜×™×‘×™×•×˜×™×§×” â€“ ×–×”×™×¨×•×ª", purpose: "UTI; ×œ× ××ª××™× ×‘×™×¨×™×“×” ×›×œ×™×™×ª×™×ª" },
];

// ============ SVG ICON COMPONENT ============
const I = ({ d, size = 20, color = "#888", sw = 2 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={sw} strokeLinecap="round" strokeLinejoin="round"><path d={d}/></svg>;
const Ic = {
  check: (s, c) => <I d="M20 6L9 17l-5-5" size={s} color={c} sw={2.5} />,
  pill: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.5 1.5l3 3-8 8-3-3a4.24 4.24 0 010-6l2-2a4.24 4.24 0 016 0z"/><line x1="12" y1="12" x2="17.5" y2="17.5"/></svg>,
  drop: (s, c) => <I d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z" size={s} color={c} />,
  fork: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 002-2V2M7 2v20M21 15V2a5 5 0 00-5 5v6c0 1.1.9 2 2 2h3zm0 0v7"/></svg>,
  run: (s, c) => <I d="M22 12l-4 0-3 9-6-18-3 9-4 0" size={s} color={c} />,
  brain: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2a5 5 0 014.5 2.8A4 4 0 0120 9a4 4 0 01-1 7.5 5 5 0 01-7 4.5 5 5 0 01-7-4.5A4 4 0 014 9a4 4 0 013.5-4.2A5 5 0 0112 2z"/><path d="M12 2v20"/></svg>,
  steth: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4.8 2.3A.3.3 0 105 2H4a2 2 0 00-2 2v5a6 6 0 006 6 6 6 0 006-6V4a2 2 0 00-2-2h-1a.2.2 0 10.3.3M8 15v1a6 6 0 006 6 6 6 0 006-6v-4"/><circle cx="20" cy="10" r="2"/></svg>,
  alert: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.73 18l-8-14a2 2 0 00-3.48 0l-8 14A2 2 0 004 21h16a2 2 0 001.73-3z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
  smile: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>,
  clip: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="8" y="2" width="8" height="4" rx="1"/><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/></svg>,
  user: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
  home: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
  edit: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.12 2.12 0 013 3L12 15l-4 1 1-4z"/></svg>,
  plus: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2.5" strokeLinecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
  x: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
  down: (s, c) => <I d="M6 9l6 6 6-6" size={s} color={c} />,
  left: (s, c) => <I d="M15 18l-6-6 6-6" size={s} color={c} />,
  right: (s, c) => <I d="M9 18l6-6-6-6" size={s} color={c} />,
  shield: (s, c) => <I d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" size={s} color={c} />,
  save: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
  print: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>,
  wc: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round"><rect x="7" y="2" width="10" height="4" rx="1"/><path d="M5 6h14v2a7 7 0 01-14 0V6z"/><path d="M9 15v4a2 2 0 002 2h2a2 2 0 002-2v-4"/></svg>,
  note: (s, c) => <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke={c} strokeWidth="2" strokeLinecap="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
};

// ============ REUSABLE COMPONENTS ============
const Chk = ({ on, toggle, size = 22 }) => (
  <div onClick={toggle} style={{ width: size, height: size, borderRadius: 6, border: on ? "none" : "2px solid #d0ccc6", background: on ? "#5a5650" : "#fff", display: "flex", alignItems: "center", justifyContent: "center", cursor: "pointer", transition: "all 0.15s", flexShrink: 0 }}>
    {on && Ic.check(size - 6, "#fff")}
  </div>
);

const Circ = ({ icon, bg = "#f3f0ec", color = "#8b7565", size = 40 }) => (
  <div style={{ width: size, height: size, borderRadius: 12, background: bg, display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 }}>
    {Ic[icon]?.(size * 0.48, color)}
  </div>
);

const Btn = ({ children, v = "primary", sm, full, dis, onClick, sx = {} }) => {
  const base = { display: "inline-flex", alignItems: "center", justifyContent: "center", gap: 8, border: "none", fontFamily: "inherit", cursor: dis ? "not-allowed" : "pointer", transition: "all 0.15s", fontWeight: 600, borderRadius: sm ? 8 : 12, padding: sm ? "8px 14px" : "12px 24px", fontSize: sm ? 13 : 15, width: full ? "100%" : undefined, opacity: dis ? 0.4 : 1 };
  const vs = { primary: { background: "#4a4a4a", color: "#fff" }, soft: { background: "#f3f0ec", color: "#5a4e42" }, outline: { background: "transparent", color: "#5a4e42", border: "1.5px solid #d8d3cc" }, danger: { background: "#f5e6e4", color: "#b5544d" }, green: { background: "#7c9a6e", color: "#fff" } };
  return <button onClick={dis ? undefined : onClick} style={{ ...base, ...vs[v], ...sx }}>{children}</button>;
};

const Inp = ({ sx, ...p }) => <input {...p} style={{ width: "100%", padding: "10px 14px", borderRadius: 10, border: "1.5px solid #e2ddd6", fontSize: 14, fontFamily: "inherit", direction: "rtl", background: "#fff", outline: "none", boxSizing: "border-box", ...sx }} />;
const Txa = ({ sx, ...p }) => <textarea {...p} style={{ width: "100%", padding: "10px 14px", borderRadius: 10, border: "1.5px solid #e2ddd6", fontSize: 14, fontFamily: "inherit", direction: "rtl", background: "#fff", outline: "none", boxSizing: "border-box", resize: "vertical", minHeight: 48, ...sx }} />;
const Tag = ({ children, on, onClick, c }) => <span onClick={onClick} style={{ display: "inline-block", padding: "4px 12px", borderRadius: 20, fontSize: 12, fontWeight: 600, cursor: onClick ? "pointer" : "default", background: on ? (c || "#4a4a4a") : "#f3f0ec", color: on ? "#fff" : "#6b6058", border: "none" }}>{children}</span>;
const Card = ({ children, sx }) => <div style={{ background: "#fff", borderRadius: 14, marginBottom: 10, boxShadow: "0 1px 3px rgba(0,0,0,0.03)", overflow: "hidden", ...sx }}>{children}</div>;

// ============ PRIVACY ============
const PRIVACY_TEXT = `×”×•×“×¢×” ×¢×œ ××™×¡×•×£ ××™×“×¢ ×‘×”×ª×× ×œ×ª×™×§×•×Ÿ 13 ×œ×—×•×§ ×”×’× ×ª ×”×¤×¨×˜×™×•×ª, ×”×ª×©×"×-1981\n\n××˜×¨×ª ×”××™×¡×•×£: × ×™×”×•×œ ×•××¢×§×‘ ××—×¨ ×”×˜×™×¤×•×œ ×”×™×•××™ ×©×œ ×”××˜×•×¤×œ/×ª.\n\n×¡×•×’×™ ×”××™×“×¢: ×¤×¨×˜×™ ×–×™×”×•×™, ××™×“×¢ ×¨×¤×•××™, ×ª×™×¢×•×“ ×¤×¢×•×œ×•×ª ×˜×™×¤×•×œ, ×¤×¨×˜×™ ×§×©×¨.\n\n×”×©×™××•×©: ××š ×•×¨×§ ×œ×¦×•×¨×›×™ × ×™×”×•×œ ×”×˜×™×¤×•×œ ×•×”×¢×‘×¨×ª ×“×•×—×•×ª ×œ×’×•×¨××™× ×¨×¤×•××™×™× ×‘×”×¡×›××ª×š.\n\n××—×¡×•×Ÿ: ××§×•××™ ×‘××›×©×™×¨×š. ×œ× ××•×¢×‘×¨ ×œ×¦×“ ×©×œ×™×©×™.\n\n×–×›×•×™×•×ª: ×¢×™×•×Ÿ, ×ª×™×§×•×Ÿ, ××—×™×§×” ×‘×›×œ ×¢×ª.\n\n××¡×™×¨×ª ×”××™×“×¢ ××¨×¦×•× ×š ×”×—×•×¤×©×™.`;

// ============ HELPERS ============
const today = () => new Date().toISOString().split("T")[0];
const fmtD = d => new Date(d + "T00:00:00").toLocaleDateString("he-IL", { weekday: "long", day: "numeric", month: "long", year: "numeric" });
const fmtT = () => new Date().toLocaleTimeString("he-IL", { hour: "2-digit", minute: "2-digit" });

// ============ MAIN ============
function CareApp() {
  const [loading, setLoading] = useState(true);
  const [profile, setProfile] = useState(null);
  const [step, setStep] = useState(0);
  const [page, setPage] = useState("dashboard");
  const [log, setLogState] = useState(null);
  const [date, setDate] = useState(today());
  const [toast, setToast] = useState("");

  useEffect(() => { (async () => { try { const r = await window.storage.get("care-profile"); if (r?.value) { setProfile(JSON.parse(r.value)); setStep(3); } } catch(e){} setLoading(false); })(); }, []);
  useEffect(() => { if (!profile) return; (async () => { try { const r = await window.storage.get(`log:${date}`); if (r?.value) setLogState(JSON.parse(r.value)); else setLogState(mkLog(profile, date)); } catch(e) { setLogState(mkLog(profile, date)); } })(); }, [date, profile]);

  const mkLog = (p, d) => ({ date: d, medications: (p.medications||[]).map(m => ({ ...m, given: false, time: "", reason: "" })), bathing: { done: false, types: [], notes: "" }, meals: { breakfast: { done: false, notes: "" }, lunch: { done: false, notes: "" }, dinner: { done: false, notes: "" }, snacks: { done: false, notes: "" } }, fluids: 0, toileting: [], diapers: 0, physicalActivity: { done: false, type: "", duration: "", notes: "" }, cognitiveActivity: { done: false, type: "", duration: "", notes: "" }, doctorVisit: { done: false, doctor: "", reason: "", notes: "" }, incidents: [], mood: "", dementiaSymptoms: [], customDementia: "", sleep: "", generalNotes: "" });

  const saveLog = async (l) => { setLogState(l); try { await window.storage.set(`log:${date}`, JSON.stringify(l)); setToast("× ×©××¨"); setTimeout(() => setToast(""), 1300); } catch(e){} };
  const savePro = async (p) => { setProfile(p); try { await window.storage.set("care-profile", JSON.stringify(p)); } catch(e){} };

  if (loading) return <div style={{ direction: "rtl", fontFamily: "'Noto Sans Hebrew',sans-serif", display: "flex", alignItems: "center", justifyContent: "center", height: "100vh", background: "#faf9f7" }}><span style={{ color: "#999" }}>×˜×•×¢×Ÿ...</span></div>;
  if (step < 3) return <div style={{ direction: "rtl", fontFamily: "'Noto Sans Hebrew','Segoe UI',sans-serif", minHeight: "100vh", background: "#faf9f7", color: "#3a3630" }}><div style={{ maxWidth: 700, margin: "0 auto", padding: 16 }}><Setup step={step} setStep={setStep} onDone={savePro} /></div></div>;

  const nav = [{ k: "dashboard", l: "×™×•××Ÿ", i: "home" }, { k: "meds", l: "×ª×¨×•×¤×•×ª", i: "pill" }, { k: "report", l: "×“×•×—", i: "clip" }, { k: "profile", l: "×¤×¨×•×¤×™×œ", i: "user" }];

  return (
    <div style={{ direction: "rtl", fontFamily: "'Noto Sans Hebrew','Segoe UI',sans-serif", minHeight: "100vh", background: "#faf9f7", color: "#3a3630", paddingBottom: 80 }}>
      <div style={{ maxWidth: 700, margin: "0 auto", padding: "0 16px" }}>
        <div style={{ textAlign: "center", padding: "20px 0 6px" }}>
          <div style={{ fontSize: 22, fontWeight: 700 }}>×©×œ×•×, {profile.caregiverName}</div>
          <div style={{ fontSize: 13, color: "#a09890", marginTop: 2 }}>×˜×™×¤×•×œ ×‘{profile.patientName}</div>
        </div>
        <div style={{ display: "flex", background: "#fff", borderRadius: 14, padding: 4, marginBottom: 16, boxShadow: "0 1px 4px rgba(0,0,0,0.04)" }}>
          {nav.map(n => <button key={n.k} onClick={() => setPage(n.k)} style={{ flex: 1, display: "flex", flexDirection: "column", alignItems: "center", gap: 2, padding: "10px 0", border: "none", borderRadius: 12, background: page === n.k ? "#f3f0ec" : "transparent", cursor: "pointer", fontFamily: "inherit" }}>{Ic[n.i]?.(20, page === n.k ? "#4a4a4a" : "#b5afa7")}<span style={{ fontSize: 11, fontWeight: 600, color: page === n.k ? "#3a3630" : "#b5afa7" }}>{n.l}</span></button>)}
        </div>
        {toast && <div style={{ position: "fixed", top: 20, left: "50%", transform: "translateX(-50%)", zIndex: 999, background: "#3a3630", color: "#fff", padding: "10px 28px", borderRadius: 10, fontSize: 14, fontWeight: 600, boxShadow: "0 4px 20px rgba(0,0,0,0.15)", display: "flex", alignItems: "center", gap: 8 }}>{Ic.check(16, "#aaa")} {toast}</div>}
        {page === "dashboard" && log && <Dashboard log={log} save={saveLog} date={date} setDate={setDate} profile={profile} />}
        {page === "meds" && <Meds profile={profile} save={savePro} />}
        {page === "report" && <Report profile={profile} />}
        {page === "profile" && <Profile profile={profile} save={savePro} />}
      </div>
    </div>
  );
}

// ============ SETUP ============
function Setup({ step, setStep, onDone }) {
  const [ok, setOk] = useState(false);
  const [f, sF] = useState({ patientName:"",patientId:"",birthDate:"",diagnoses:"",allergies:"",caregiverName:"",caregiverPhone:"",doctorName:"",doctorPhone:"",kupat:"",emergencyContact:"",emergencyPhone:"",useDiapers:false });
  const [sel, setSel] = useState([]);
  const [ms, setMs] = useState("");
  const [mf, setMf] = useState("×”×›×œ");
  const [sc, setSc] = useState(false);
  const [cm, setCm] = useState({ name:"",dosage:"",times:"" });
  const cats = ["×”×›×œ", ...new Set(MEDICATION_DB.map(m => m.category))];
  const filt = MEDICATION_DB.filter(m => (!ms || m.name.includes(ms) || m.generic.toLowerCase().includes(ms.toLowerCase())) && (mf === "×”×›×œ" || m.category === mf));

  if (step === 0) return (<div>
    <Card sx={{ padding: 24, textAlign: "center" }}><Circ icon="home" bg="#f3f0ec" color="#5a4e42" size={56} /><h1 style={{ fontSize: 22, fontWeight: 700, margin: "12px 0 4px" }}>××¢×¨×›×ª × ×™×”×•×œ ×˜×™×¤×•×œ ×™×•××™</h1><p style={{ fontSize: 14, color: "#a09890" }}>× ×™×”×•×œ ×•××¢×§×‘ ××—×¨ ×˜×™×¤×•×œ ×‘×§×©×™×©×™×</p></Card>
    <Card sx={{ padding: 20 }}>
      <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 14 }}><Circ icon="shield" bg="#f0ede8" color="#6b6058" size={36} /><span style={{ fontSize: 16, fontWeight: 700 }}>×”×¡×›××” ×œ××™×¡×•×£ ××™×“×¢</span></div>
      <div style={{ background: "#faf9f7", borderRadius: 10, padding: 14, fontSize: 13, lineHeight: 1.8, whiteSpace: "pre-wrap", maxHeight: 240, overflowY: "auto", border: "1px solid #eee", marginBottom: 14 }}>{PRIVACY_TEXT}</div>
      <div onClick={() => setOk(!ok)} style={{ display: "flex", alignItems: "center", gap: 10, padding: "12px 14px", borderRadius: 10, cursor: "pointer", background: ok ? "#f3f1ee" : "#faf9f7", border: ok ? "1.5px solid #5a5650" : "1.5px solid transparent" }}><Chk on={ok} toggle={() => {}} /><span style={{ fontWeight: 600, fontSize: 14 }}>×§×¨××ª×™ ×•×”×‘× ×ª×™ ×•×× ×™ ××¡×›×™×/×”</span></div>
      <div style={{ marginTop: 16 }}><Btn v="primary" full dis={!ok} onClick={() => setStep(1)}>×”××©×š</Btn></div>
    </Card>
  </div>);

  if (step === 1) return (<div>
    <Card sx={{ padding: 20 }}>
      <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 16 }}><Circ icon="user" bg="#f0ede8" color="#6b6058" size={36} /><span style={{ fontSize: 16, fontWeight: 700 }}>×¤×¨×˜×™ ×”××˜×•×¤×œ/×ª ×•×× ×©×™ ×§×©×¨</span></div>
      {[["patientName","×©× ×”××˜×•×¤×œ/×ª *","×©× ××œ×"],["patientId","×ª.×–.",""],["kupat","×§×•×¤×ª ×—×•×œ×™×","×›×œ×œ×™×ª/××›×‘×™/×××•×—×“×ª/×œ××•××™×ª"],["caregiverName","×©× ×”××˜×¤×œ/×ª *","×©× ××œ×"],["caregiverPhone","×˜×œ×¤×•×Ÿ ××˜×¤×œ/×ª",""],["doctorName","×¨×•×¤×/×”",""],["doctorPhone","×˜×œ×¤×•×Ÿ ×¨×•×¤×/×”",""],["emergencyContact","××™×© ×§×©×¨ ×—×™×¨×•×",""],["emergencyPhone","×˜×œ×¤×•×Ÿ ×—×™×¨×•×",""]].map(([k,l,p]) => <div key={k} style={{ marginBottom: 8 }}><label style={{ fontSize: 13, fontWeight: 600, color: "#6b6058", display: "block", marginBottom: 3 }}>{l}</label><Inp type={k==="birthDate"?"date":"text"} value={f[k]} onChange={e => sF({...f,[k]:e.target.value})} placeholder={p} /></div>)}
      <div style={{ marginBottom: 8 }}><label style={{ fontSize: 13, fontWeight: 600, color: "#6b6058", display: "block", marginBottom: 3 }}>×ª××¨×™×š ×œ×™×“×”</label><Inp type="date" value={f.birthDate} onChange={e => sF({...f,birthDate:e.target.value})} /></div>
      <div style={{ marginBottom: 8 }}><label style={{ fontSize: 13, fontWeight: 600, color: "#6b6058", display: "block", marginBottom: 3 }}>××‘×—× ×•×ª</label><Txa value={f.diagnoses} onChange={e => sF({...f,diagnoses:e.target.value})} placeholder="×¡×•×›×¨×ª, ×“×× ×¦×™×”..." rows={2} /></div>
      <div style={{ marginBottom: 8 }}><label style={{ fontSize: 13, fontWeight: 600, color: "#6b6058", display: "block", marginBottom: 3 }}>××œ×¨×’×™×•×ª</label><Txa value={f.allergies} onChange={e => sF({...f,allergies:e.target.value})} rows={2} /></div>
      <div onClick={()=>sF({...f,useDiapers:!f.useDiapers})} style={{ display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderRadius:10,cursor:"pointer",background:f.useDiapers?"#f3f1ee":"#faf9f7",border:f.useDiapers?"1.5px solid #5a5650":"1.5px solid #e2ddd6",marginBottom:8 }}><Chk on={f.useDiapers} toggle={()=>{}}/><span style={{ fontWeight:600,fontSize:14 }}>×”××˜×•×¤×œ/×ª ××©×ª××©/×ª ×‘×—×™×ª×•×œ×™×</span></div>
      <div style={{ display: "flex", gap: 8, marginTop: 16 }}><Btn v="outline" onClick={() => setStep(0)}>×—×–×¨×”</Btn><Btn v="primary" full dis={!f.patientName||!f.caregiverName} onClick={() => setStep(2)}>×”××©×š ×œ×ª×¨×•×¤×•×ª</Btn></div>
    </Card>
  </div>);

  if (step === 2) return (<div>
    <Card sx={{ padding: 20 }}>
      <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 14 }}><Circ icon="pill" bg="#f3f1ee" color="#6b6058" size={36} /><span style={{ fontSize: 16, fontWeight: 700 }}>×ª×¨×•×¤×•×ª ×§×‘×•×¢×•×ª</span></div>
      <p style={{ fontSize: 13, color: "#a09890", marginBottom: 10 }}>×¡××Ÿ/×™ ×ª×¨×•×¤×•×ª. × ×™×ª×Ÿ ×œ×¢×¨×•×š ×’× ×××•×—×¨ ×™×•×ª×¨.</p>
      <Inp value={ms} onChange={e => setMs(e.target.value)} placeholder="ğŸ” ×—×™×¤×•×©..." sx={{ marginBottom: 8 }} />
      <div style={{ display: "flex", gap: 4, flexWrap: "wrap", marginBottom: 8 }}>{cats.slice(0,12).map(c => <Tag key={c} on={mf===c} onClick={() => setMf(c)}>{c}</Tag>)}</div>
      {sel.length > 0 && <div style={{ background: "#f3f1ee", borderRadius: 10, padding: 10, marginBottom: 10 }}><div style={{ fontSize: 12, fontWeight: 700, color: "#5a5650", marginBottom: 4 }}>× ×‘×—×¨×• ({sel.length}):</div><div style={{ display: "flex", flexWrap: "wrap", gap: 4 }}>{sel.map((m,i) => <Tag key={i} on c="#5a5650" onClick={() => setSel(sel.filter((_,j)=>j!==i))}>âœ• {m.name}</Tag>)}</div></div>}
      <div style={{ maxHeight: 260, overflowY: "auto", borderRadius: 10, border: "1px solid #eee" }}>
        {filt.map(m => { const s = sel.some(x=>x.id===m.id); return (<div key={m.id} onClick={() => s ? setSel(sel.filter(x=>x.id!==m.id)) : setSel([...sel,{...m,dosage:"",times:""}])} style={{ display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", cursor: "pointer", borderBottom: "1px solid #f5f3f0", background: s ? "#f9faf8" : "#fff" }}><Chk on={s} toggle={()=>{}} /><div style={{ flex: 1 }}><div style={{ fontWeight: 600, fontSize: 13 }}>{m.name}</div><div style={{ fontSize: 11, color: "#a09890" }}>{m.generic} â€” {m.purpose}</div></div><span style={{ fontSize: 10, color: "#b5afa7", background: "#f5f3f0", padding: "2px 8px", borderRadius: 10 }}>{m.category}</span></div>); })}
      </div>
      <Btn v="soft" sm full onClick={() => setSc(!sc)} sx={{ marginTop: 8 }}>{Ic.plus(14,"#5a4e42")} ×ª×¨×•×¤×” ××•×ª×××ª</Btn>
      {sc && <div style={{ background: "#faf9f7", borderRadius: 10, padding: 12, marginTop: 8 }}><Inp value={cm.name} onChange={e => setCm({...cm,name:e.target.value})} placeholder="×©×" sx={{ marginBottom: 6 }} /><div style={{ display: "flex", gap: 6 }}><Inp value={cm.dosage} onChange={e => setCm({...cm,dosage:e.target.value})} placeholder="××™× ×•×Ÿ" /><Inp value={cm.times} onChange={e => setCm({...cm,times:e.target.value})} placeholder="×–×× ×™ ××ª×Ÿ" /></div><Btn v="primary" sm onClick={() => { if(cm.name){ setSel([...sel,{id:`c_${Date.now()}`,name:cm.name,generic:"",category:"××•×ª××",purpose:"",dosage:cm.dosage,times:cm.times}]); setCm({name:"",dosage:"",times:""}); setSc(false); }}} sx={{ marginTop: 8 }}>×”×•×¡×£</Btn></div>}
      <div style={{ display: "flex", gap: 8, marginTop: 16 }}><Btn v="outline" onClick={() => setStep(1)}>×—×–×¨×”</Btn><Btn v="primary" full onClick={() => { onDone({...f,medications:sel,createdAt:new Date().toISOString()}); setStep(3); }}>{Ic.save(16,"#fff")} ×©××•×¨ ×•×”×ª×—×œ</Btn></div>
    </Card>
  </div>);
  return null;
}

// ============ DASHBOARD ============
function Dashboard({ log, save, date, setDate, profile }) {
  const [op, setOp] = useState(null);
  const [iF, sIF] = useState({ type:"",time:"",description:"" });
  const [tF, sTF] = useState({ time:"",type:"",notes:"" });
  const [medEdit, setMedEdit] = useState(null);
  const [notes, setNotes] = useState(log.generalNotes||"");
  useEffect(() => { setNotes(log.generalNotes||""); }, [log.date]);
  const tg = s => setOp(op===s?null:s);
  const u = (p, v) => { const n = JSON.parse(JSON.stringify(log)); const k=p.split("."); let o=n; for(let i=0;i<k.length-1;i++)o=o[k[i]]; o[k[k.length-1]]=v; save(n); };

  const INC = ["×”×ª×§×£","×›×¢×¡/×ª×•×§×¤× ×•×ª","×›××‘×™×","× ×¤×™×œ×”","×‘×œ×‘×•×œ","×¡×™×¨×•×‘ ×˜×™×¤×•×œ","×—×•×","×§×•×¦×¨ × ×©×™××”","×”×§××”/×©×œ×©×•×œ","××—×¨"];
  const MOODS = [{v:"××¦×•×™×Ÿ",e:"ğŸ˜Š"},{v:"×˜×•×‘",e:"ğŸ™‚"},{v:"×¡×‘×™×¨",e:"ğŸ˜"},{v:"×¢×¦×•×‘",e:"ğŸ˜¢"},{v:"×—×¨×“",e:"ğŸ˜°"},{v:"×›×•×¢×¡",e:"ğŸ˜ "}];
  const SLEEPS = ["×©×™× ×” ×˜×•×‘×”","×©×™× ×” ×¡×‘×™×¨×”","×™×©×Ÿ/×” ××¢×˜","×œ× ×™×©×Ÿ/×” ×›×œ×œ","×§×/×” ×‘×œ×™×œ×”"];
  const pct = (()=>{ let t=0,d=0; log.medications.forEach(m=>{t++;if(m.given)d++}); t++;if(log.bathing.done)d++; ["breakfast","lunch","dinner"].forEach(m=>{t++;if(log.meals[m].done)d++}); t+=2;if(log.physicalActivity.done)d++;if(log.cognitiveActivity.done)d++; return t?Math.round(d/t*100):0; })();

  const Sec = ({ icon, bg, col, title, badge, red, isOpen, onTog, children }) => (
    <Card><div onClick={onTog} style={{ display:"flex",alignItems:"center",gap:12,padding:"14px 16px",cursor:"pointer" }}><Circ icon={icon} bg={bg} color={col} size={40} /><div style={{ flex:1 }}><div style={{ fontWeight:700,fontSize:15,color:"#3a3630" }}>{title}</div></div>{badge&&<span style={{ fontSize:12,fontWeight:600,padding:"3px 10px",borderRadius:8,background:red?"#fef0ee":"#f3f1ee",color:red?"#b5544d":"#6b6058" }}>{badge}</span>}<span style={{ transition:"transform 0.2s",transform:isOpen?"rotate(180deg)":"rotate(0)" }}>{Ic.down(18,"#c8c4be")}</span></div>{isOpen&&<div style={{ borderTop:"1px solid #f0ede8",padding:"6px 0 10px" }}>{children}</div>}</Card>
  );

  return (<div>
    <Card sx={{ display:"flex",alignItems:"center",padding:"10px 14px" }}>
      <div onClick={()=>setDate(new Date(new Date(date).getTime()+86400000).toISOString().split("T")[0])} style={{ cursor:"pointer",padding:6 }}>{Ic.right(20,"#6b6058")}</div>
      <div style={{ flex:1,textAlign:"center" }}><div style={{ fontWeight:700,fontSize:15 }}>{fmtD(date)}</div>{date===today()&&<span style={{ fontSize:11,color:"#5a5650",fontWeight:600 }}>×”×™×•×</span>}</div>
      <div onClick={()=>setDate(new Date(new Date(date).getTime()-86400000).toISOString().split("T")[0])} style={{ cursor:"pointer",padding:6 }}>{Ic.left(20,"#6b6058")}</div>
    </Card>

    <Card sx={{ padding:"12px 16px" }}>
      <div style={{ display:"flex",justifyContent:"space-between",marginBottom:5 }}><span style={{ fontSize:13,fontWeight:600 }}>×”×ª×§×“××•×ª</span><span style={{ fontSize:13,fontWeight:700,color:"#5a5650" }}>{pct}%</span></div>
      <div style={{ height:6,borderRadius:3,background:"#eceae6",overflow:"hidden" }}><div style={{ height:"100%",borderRadius:3,width:`${pct}%`,background:pct>70?"#5a5650":pct>40?"#a09890":"#cf6b5e",transition:"width 0.4s" }}/></div>
    </Card>

    <Sec icon="pill" bg="#eef3eb" col="#5d7f4e" title="×ª×¨×•×¤×•×ª" badge={`${log.medications.filter(m=>m.given).length}/${log.medications.length}`} isOpen={op==="meds"} onTog={()=>tg("meds")}>
      {log.medications.length===0&&<div style={{ padding:16,textAlign:"center",color:"#a09890",fontSize:13 }}>×¢×‘×•×¨/×™ ×œ"×ª×¨×•×¤×•×ª" ×œ×”×•×¡×¤×”.</div>}
      {log.medications.map((m,i)=>(
        <div key={i}>
          <div style={{ display:"flex",alignItems:"flex-start",gap:10,padding:"10px 16px",borderBottom:medEdit===i?"none":"1px solid #f8f6f3" }}>
            <div style={{ paddingTop:2 }}><Chk on={m.given} toggle={()=>{ const ms=[...log.medications]; ms[i]={...ms[i],given:!ms[i].given,time:!ms[i].given?fmtT():"",reason:ms[i].given?"":ms[i].reason}; save({...log,medications:ms}); }}/></div>
            <div style={{ flex:1 }}>
              <div style={{ fontWeight:600,fontSize:14,color:m.given?"#a09890":"#2d2a26",textDecoration:m.given?"line-through":"none" }}>{m.name}</div>
              {m.dosage&&<div style={{ fontSize:12,color:"#b5afa7" }}>{m.dosage}{m.times?` Â· ${m.times}`:""}</div>}
              {m.given&&m.time&&<div style={{ fontSize:11,color:"#5a5650",marginTop:2 }}>× ×™×ª× ×” ×‘-{m.time}</div>}
              {!m.given&&<Inp value={m.reason} placeholder="×¡×™×‘×” ×œ××™ ××ª×Ÿ (××•×¤×¦×™×•× ×œ×™)" onChange={e=>{ const ms=[...log.medications]; ms[i]={...ms[i],reason:e.target.value}; save({...log,medications:ms}); }} sx={{ marginTop:6,fontSize:12,padding:"6px 10px" }}/>}
            </div>
            <span onClick={()=>setMedEdit(medEdit===i?null:i)} style={{ cursor:"pointer",padding:4 }}>{Ic.edit(15,"#c8c4be")}</span>
          </div>
          {medEdit===i&&(
            <div style={{ padding:"8px 16px 12px",background:"#faf9f7",borderBottom:"1px solid #f0ede8" }}>
              <div style={{ display:"flex",gap:6,marginBottom:8 }}>
                <Inp value={m.dosage||""} onChange={e=>{ const ms=[...log.medications]; ms[i]={...ms[i],dosage:e.target.value}; save({...log,medications:ms}); }} placeholder="××™× ×•×Ÿ" sx={{ flex:1,fontSize:12,padding:"6px 10px" }}/>
                <Inp value={m.times||""} onChange={e=>{ const ms=[...log.medications]; ms[i]={...ms[i],times:e.target.value}; save({...log,medications:ms}); }} placeholder="×–×× ×™ ××ª×Ÿ" sx={{ flex:1,fontSize:12,padding:"6px 10px" }}/>
              </div>
              <div style={{ display:"flex",gap:6,justifyContent:"flex-end" }}>
                <Btn v="soft" sm onClick={()=>{const ms=log.medications.filter((_,j)=>j!==i);save({...log,medications:ms});setMedEdit(null)}} sx={{ color:"#b5544d",fontSize:11 }}>{Ic.x(12,"#b5544d")} ×”×¡×¨ ××”×™×•×</Btn>
                <Btn v="soft" sm onClick={()=>setMedEdit(null)} sx={{ fontSize:11 }}>×¡×’×•×¨</Btn>
              </div>
            </div>
          )}
        </div>
      ))}
    </Sec>

    <Sec icon="drop" bg="#edf4f8" col="#5a8ba8" title="×¨×—×¦×”/×”×™×’×™×™× ×”" badge={(log.bathing?.types||[]).length>0?`${(log.bathing.types||[]).length}`:log.bathing?.done?"×‘×•×¦×¢":null} isOpen={op==="bath"} onTog={()=>tg("bath")}>
      <div style={{ padding:"8px 16px 10px" }}>
        <div style={{ fontSize:13,fontWeight:600,color:"#6b6058",marginBottom:8 }}>×¡××Ÿ/×™ ××” ×‘×•×¦×¢:</div>
        {["×¨×—×¦×” ×—×¦×™ ×’×•×£","××§×œ×—×ª ××œ××”","××§×œ×—×ª ×•×—×¤×™×¤×”","×’×–×™×¨×ª ×¦×™×¤×•×¨× ×™×™×"].map(t=>{
          const types = log.bathing?.types||[];
          const on = types.includes(t);
          return <div key={t} style={{ display:"flex",alignItems:"center",gap:10,padding:"8px 0",borderBottom:"1px solid #f8f6f3",cursor:"pointer" }} onClick={()=>{
            const nt = on ? types.filter(x=>x!==t) : [...types,t];
            save({...log, bathing:{...log.bathing, done:nt.length>0, types:nt}});
          }}><Chk on={on} toggle={()=>{}}/><span style={{ fontSize:14,fontWeight:on?600:400 }}>{t}</span></div>;
        })}
        <Inp value={log.bathing?.notes||""} onChange={e=>save({...log,bathing:{...log.bathing,notes:e.target.value}})} placeholder="×”×¢×¨×•×ª" sx={{ fontSize:13,marginTop:8 }}/>
      </div>
    </Sec>

    <Sec icon="fork" bg="#fef6ed" col="#c4913f" title="××¨×•×—×•×ª ×•×©×ª×™×™×”" badge={`${["breakfast","lunch","dinner"].filter(m=>log.meals[m].done).length}/3`} isOpen={op==="meals"} onTog={()=>tg("meals")}>
      {[{k:"breakfast",l:"×‘×•×§×¨"},{k:"lunch",l:"×¦×”×¨×™×™×"},{k:"dinner",l:"×¢×¨×‘"},{k:"snacks",l:"×‘×™× ×™×™×"}].map(ml=>(
        <div key={ml.k}><div style={{ display:"flex",alignItems:"center",gap:10,padding:"10px 16px" }}><Chk on={log.meals[ml.k].done} toggle={()=>u(`meals.${ml.k}.done`,!log.meals[ml.k].done)}/><span style={{ fontWeight:600,fontSize:14 }}>××¨×•×—×ª {ml.l}</span></div>{log.meals[ml.k].done&&<div style={{ padding:"0 16px 6px" }}><Inp value={log.meals[ml.k].notes} onChange={e=>u(`meals.${ml.k}.notes`,e.target.value)} placeholder="××” ××›×œ/×”?" sx={{ fontSize:13 }}/></div>}</div>
      ))}
      <div style={{ borderTop:"1px solid #f0ede8",padding:"10px 16px" }}>
        <div style={{ fontSize:13,fontWeight:600,color:"#6b6058",marginBottom:8 }}>ğŸ¥¤ ×©×ª×™×™×” (×›×•×¡×•×ª × ×•×–×œ×™×)</div>
        <div style={{ display:"flex",alignItems:"center",gap:10 }}>
          <Btn v="soft" sm onClick={()=>save({...log,fluids:Math.max(0,(log.fluids||0)-1)})} sx={{ padding:"6px 14px",fontSize:18,fontWeight:700 }}>âˆ’</Btn>
          <div style={{ textAlign:"center",minWidth:60 }}><div style={{ fontSize:24,fontWeight:700,color:"#3a3630" }}>{log.fluids||0}</div><div style={{ fontSize:11,color:"#a09890" }}>{((log.fluids||0)*250)} ×"×œ</div></div>
          <Btn v="soft" sm onClick={()=>save({...log,fluids:(log.fluids||0)+1})} sx={{ padding:"6px 14px",fontSize:18,fontWeight:700 }}>+</Btn>
        </div>
      </div>
    </Sec>

    <Sec icon="wc" bg="#f3f0ec" col="#8b7565" title="×¦×¨×›×™×" badge={log.toileting.length>0?`${log.toileting.length}`:null} isOpen={op==="wc"} onTog={()=>tg("wc")}>
      {log.toileting.map((t,i)=><div key={i} style={{ display:"flex",alignItems:"center",gap:8,padding:"8px 16px",borderBottom:"1px solid #f8f6f3",fontSize:13 }}><span style={{ color:"#a09890" }}>{t.time}</span><Tag on c="#8b7565">{t.type}</Tag>{t.notes&&<span style={{ flex:1,color:"#6b6058" }}>{t.notes}</span>}<span style={{ cursor:"pointer" }} onClick={()=>save({...log,toileting:log.toileting.filter((_,j)=>j!==i)})}>{Ic.x(14,"#b5afa7")}</span></div>)}
      <div style={{ display:"flex",gap:6,flexWrap:"wrap",padding:"8px 16px" }}>
        <input type="time" value={tF.time} onChange={e=>sTF({...tF,time:e.target.value})} style={{ width:90,padding:"6px 8px",borderRadius:8,border:"1.5px solid #e2ddd6",fontSize:13,fontFamily:"inherit" }}/>
        <select value={tF.type} onChange={e=>sTF({...tF,type:e.target.value})} style={{ flex:1,padding:"6px 8px",borderRadius:8,border:"1.5px solid #e2ddd6",fontSize:13,fontFamily:"inherit",background:"#fff" }}><option value="">×¡×•×’</option><option>×©×ª×Ÿ</option><option>×™×¦×™××”</option><option>×™×¦×™××” + ×©×ª×Ÿ</option></select>
        <Inp value={tF.notes} onChange={e=>sTF({...tF,notes:e.target.value})} placeholder="×”×¢×¨×•×ª" sx={{ flex:"1 1 100%",fontSize:13,padding:"6px 10px" }}/>
        <Btn v="primary" sm onClick={()=>{ if(tF.type){ save({...log,toileting:[...log.toileting,{...tF,time:tF.time||fmtT()}]}); sTF({time:"",type:"",notes:""}); }}}>×”×•×¡×£</Btn>
      </div>
    </Sec>

    {profile.useDiapers && (
      <Sec icon="wc" bg="#f3f0ec" col="#a09890" title="×”×—×œ×¤×ª ×—×™×ª×•×œ×™×" badge={(log.diapers||0)>0?`${log.diapers}`:null} isOpen={op==="diap"} onTog={()=>tg("diap")}>
        <div style={{ padding:"10px 16px" }}>
          <div style={{ fontSize:13,fontWeight:600,color:"#6b6058",marginBottom:10 }}>×›××” ×—×™×ª×•×œ×™× ×”×•×—×œ×¤×• ×”×™×•×?</div>
          <div style={{ display:"flex",gap:6,flexWrap:"wrap",marginBottom:8 }}>
            {[1,2,3,4,5].map(n=><Btn key={n} v={(log.diapers||0)===n?"primary":"soft"} sm onClick={()=>save({...log,diapers:n})} sx={{ minWidth:44 }}>{n}</Btn>)}
          </div>
          <div style={{ display:"flex",alignItems:"center",gap:8 }}>
            <span style={{ fontSize:13,color:"#6b6058" }}>××—×¨:</span>
            <Inp type="number" value={(log.diapers||0)>5?(log.diapers||""):""} onChange={e=>save({...log,diapers:parseInt(e.target.value)||0})} placeholder="××¡×¤×¨" sx={{ width:80,fontSize:13,padding:"6px 10px",textAlign:"center" }}/>
          </div>
        </div>
      </Sec>
    )}

    <Sec icon="run" bg="#eef3eb" col="#5d7f4e" title="×¤×¢×™×œ×•×ª ×’×•×¤× ×™×ª" badge={log.physicalActivity.done?"×‘×•×¦×¢":null} isOpen={op==="phys"} onTog={()=>tg("phys")}>
      <div style={{ display:"flex",alignItems:"center",gap:10,padding:"10px 16px" }}><Chk on={log.physicalActivity.done} toggle={()=>u("physicalActivity.done",!log.physicalActivity.done)}/><span style={{ fontWeight:600,fontSize:14 }}>×‘×•×¦×¢×” ×¤×¢×™×œ×•×ª ×’×•×¤× ×™×ª</span></div>
      {log.physicalActivity.done&&<div style={{ padding:"0 16px 8px" }}>
        <div style={{ display:"flex",gap:6,flexWrap:"wrap",marginBottom:8 }}>
          {["×”×œ×™×›×”","×™×©×™×‘×”","×ª× ×•×¢×ª ×™×“×™×™×","×ª×¨×’×™×œ×™×","×¤×™×–×™×•×ª×¨×¤×™×”"].map(t=><Btn key={t} v={log.physicalActivity.type===t?"primary":"soft"} sm onClick={()=>u("physicalActivity.type",t)}>{t}</Btn>)}
        </div>
        <div style={{ display:"flex",gap:6,flexWrap:"wrap" }}>
          <Inp value={log.physicalActivity.type&&!["×”×œ×™×›×”","×™×©×™×‘×”","×ª× ×•×¢×ª ×™×“×™×™×","×ª×¨×’×™×œ×™×","×¤×™×–×™×•×ª×¨×¤×™×”"].includes(log.physicalActivity.type)?log.physicalActivity.type:""} onChange={e=>u("physicalActivity.type",e.target.value)} placeholder="×¡×•×’ ××—×¨..." sx={{ flex:1,fontSize:13,padding:"6px 10px" }}/>
          <Inp value={log.physicalActivity.duration} onChange={e=>u("physicalActivity.duration",e.target.value)} placeholder="×“×§×•×ª" sx={{ width:80,flex:"0 0 80px",fontSize:13,padding:"6px 10px" }}/>
        </div>
        <Inp value={log.physicalActivity.notes} onChange={e=>u("physicalActivity.notes",e.target.value)} placeholder="×”×¢×¨×•×ª" sx={{ flex:"1 1 100%",fontSize:13,padding:"6px 10px",marginTop:6 }}/>
      </div>}
    </Sec>

    <Sec icon="brain" bg="#f0ecf5" col="#7d6b99" title="×¤×¢×™×œ×•×ª ×§×•×’× ×™×˜×™×‘×™×ª" badge={log.cognitiveActivity.done?"×‘×•×¦×¢":null} isOpen={op==="cog"} onTog={()=>tg("cog")}>
      <div style={{ display:"flex",alignItems:"center",gap:10,padding:"10px 16px" }}><Chk on={log.cognitiveActivity.done} toggle={()=>u("cognitiveActivity.done",!log.cognitiveActivity.done)}/><span style={{ fontWeight:600,fontSize:14 }}>×‘×•×¦×¢×” ×¤×¢×™×œ×•×ª ×§×•×’× ×™×˜×™×‘×™×ª</span></div>
      {log.cognitiveActivity.done&&<div style={{ padding:"0 16px 8px" }}>
        <div style={{ display:"flex",gap:6,flexWrap:"wrap",marginBottom:8 }}>
          {["××©×—×§ ××•×—","×—×™×“×•× ×™×/×ª×©×‘×¦×™×","×™×¦×™×¨×”","×§×¨×™××”","×˜×œ×•×•×™×–×™×”","××©×—×§ ××—×©×‘"].map(t=><Btn key={t} v={log.cognitiveActivity.type===t?"primary":"soft"} sm onClick={()=>u("cognitiveActivity.type",t)}>{t}</Btn>)}
        </div>
        <div style={{ display:"flex",gap:6,flexWrap:"wrap" }}>
          <Inp value={log.cognitiveActivity.type&&!["××©×—×§ ××•×—","×—×™×“×•× ×™×/×ª×©×‘×¦×™×","×™×¦×™×¨×”","×§×¨×™××”","×˜×œ×•×•×™×–×™×”","××©×—×§ ××—×©×‘"].includes(log.cognitiveActivity.type)?log.cognitiveActivity.type:""} onChange={e=>u("cognitiveActivity.type",e.target.value)} placeholder="×¡×•×’ ××—×¨..." sx={{ flex:1,fontSize:13,padding:"6px 10px" }}/>
          <Inp value={log.cognitiveActivity.duration} onChange={e=>u("cognitiveActivity.duration",e.target.value)} placeholder="×“×§×•×ª" sx={{ width:80,flex:"0 0 80px",fontSize:13,padding:"6px 10px" }}/>
        </div>
        <Inp value={log.cognitiveActivity.notes} onChange={e=>u("cognitiveActivity.notes",e.target.value)} placeholder="×”×¢×¨×•×ª" sx={{ flex:"1 1 100%",fontSize:13,padding:"6px 10px",marginTop:6 }}/>
      </div>}
    </Sec>

    <Sec icon="steth" bg="#edf4f8" col="#5a8ba8" title="×‘×™×§×•×¨ ×¨×•×¤×" badge={log.doctorVisit.done?"×‘×•×¦×¢":null} isOpen={op==="doc"} onTog={()=>tg("doc")}>
      <div style={{ display:"flex",alignItems:"center",gap:10,padding:"10px 16px" }}><Chk on={log.doctorVisit.done} toggle={()=>u("doctorVisit.done",!log.doctorVisit.done)}/><span style={{ fontWeight:600,fontSize:14 }}>×”×™×” ×‘×™×§×•×¨ ×¨×•×¤×</span></div>
      {log.doctorVisit.done&&<div style={{ display:"flex",gap:6,flexWrap:"wrap",padding:"0 16px 8px" }}><Inp value={log.doctorVisit.doctor} onChange={e=>u("doctorVisit.doctor",e.target.value)} placeholder="×©× ×”×¨×•×¤×/×”" sx={{ flex:1,fontSize:13,padding:"6px 10px" }}/><Inp value={log.doctorVisit.reason} onChange={e=>u("doctorVisit.reason",e.target.value)} placeholder="×¡×™×‘×”" sx={{ flex:1,fontSize:13,padding:"6px 10px" }}/><Txa value={log.doctorVisit.notes} onChange={e=>u("doctorVisit.notes",e.target.value)} placeholder="×¡×™×›×•× / ×”××œ×¦×•×ª" rows={2} sx={{ flex:"1 1 100%",fontSize:13,padding:"6px 10px" }}/></div>}
    </Sec>

    <Sec icon="alert" bg="#fef0ee" col="#b5544d" title="××™×¨×•×¢×™× ×—×¨×™×’×™×" badge={log.incidents.length>0?`${log.incidents.length}`:null} red={log.incidents.length>0} isOpen={op==="inc"} onTog={()=>tg("inc")}>
      {log.incidents.map((inc,i)=><div key={i} style={{ display:"flex",alignItems:"center",gap:8,padding:"8px 16px",borderBottom:"1px solid #f8f6f3",fontSize:13 }}><span style={{ width:6,height:6,borderRadius:3,background:"#cf6b5e",flexShrink:0 }}/><Tag on c="#b5544d">{inc.type}</Tag><span style={{ color:"#a09890",fontSize:12 }}>{inc.time}</span><span style={{ flex:1 }}>{inc.description}</span><span style={{ cursor:"pointer" }} onClick={()=>save({...log,incidents:log.incidents.filter((_,j)=>j!==i)})}>{Ic.x(14,"#b5afa7")}</span></div>)}
      <div style={{ padding:"8px 16px" }}><div style={{ display:"flex",gap:6,marginBottom:6 }}><select value={iF.type} onChange={e=>sIF({...iF,type:e.target.value})} style={{ flex:1,padding:"6px 8px",borderRadius:8,border:"1.5px solid #e2ddd6",fontSize:13,fontFamily:"inherit",background:"#fff" }}><option value="">×¡×•×’ ××™×¨×•×¢</option>{INC.map(t=><option key={t}>{t}</option>)}</select><input type="time" value={iF.time} onChange={e=>sIF({...iF,time:e.target.value})} style={{ width:90,padding:"6px 8px",borderRadius:8,border:"1.5px solid #e2ddd6",fontSize:13,fontFamily:"inherit" }}/></div><div style={{ display:"flex",gap:6 }}><Inp value={iF.description} onChange={e=>sIF({...iF,description:e.target.value})} placeholder="×ª×™××•×¨" sx={{ flex:1,fontSize:13,padding:"6px 10px" }}/><Btn v="danger" sm onClick={()=>{ if(iF.type){ save({...log,incidents:[...log.incidents,{...iF,time:iF.time||fmtT()}]}); sIF({type:"",time:"",description:""}); }}}>×”×•×¡×£</Btn></div></div>
    </Sec>

    <Sec icon="smile" bg="#fef6ed" col="#c4913f" title="××¦×‘ ×¨×•×— ×•×©×™× ×”" isOpen={op==="mood"} onTog={()=>tg("mood")}>
      <div style={{ padding:"6px 16px 10px" }}>
        <div style={{ fontSize:13,fontWeight:600,color:"#6b6058",marginBottom:6 }}>××¦×‘ ×¨×•×—</div>
        <div style={{ display:"flex",gap:6,flexWrap:"wrap",marginBottom:12 }}>{MOODS.map(m=><Btn key={m.v} v={log.mood===m.v?"primary":"soft"} sm onClick={()=>u("mood",m.v)}>{m.e} {m.v}</Btn>)}</div>

        <div style={{ fontSize:13,fontWeight:600,color:"#6b6058",marginBottom:6 }}>×ª×¡××™× ×™ ×“×× ×¦×™×” (× ×™×ª×Ÿ ×œ×¡××Ÿ ××¡×¤×¨)</div>
        <div style={{ display:"flex",gap:6,flexWrap:"wrap",marginBottom:6 }}>
          {["×”×–×™×•×ª","×—×¨×“×”","×–×¢×","××™ ×©×§×˜","×¨×•×¦×” ×”×‘×™×ª×”"].map(s=>{
            const ds = log.dementiaSymptoms||[];
            const on = ds.includes(s);
            return <Btn key={s} v={on?"primary":"soft"} sm onClick={()=>{
              const nd = on ? ds.filter(x=>x!==s) : [...ds,s];
              save({...log,dementiaSymptoms:nd});
            }}>{s}</Btn>;
          })}
        </div>
        <div style={{ display:"flex",gap:6,alignItems:"center" }}>
          <Inp value={log.customDementia||""} onChange={e=>save({...log,customDementia:e.target.value})} placeholder="×ª×¡××™×Ÿ × ×•×¡×£..." sx={{ flex:1,fontSize:13,padding:"6px 10px" }}/>
        </div>

        <div style={{ fontSize:13,fontWeight:600,color:"#6b6058",marginBottom:6,marginTop:12 }}>×©×™× ×” (×œ×™×œ×” ×§×•×“×)</div>
        <div style={{ display:"flex",gap:6,flexWrap:"wrap" }}>{SLEEPS.map(s=><Btn key={s} v={log.sleep===s?"primary":"soft"} sm onClick={()=>u("sleep",s)}>{s}</Btn>)}</div>
      </div>
    </Sec>

    <Card sx={{ padding:"14px 16px" }}>
      <div style={{ display:"flex",alignItems:"center",gap:8,marginBottom:10 }}>{Ic.note(18,"#8b7565")}<span style={{ fontWeight:700,fontSize:15 }}>×”×¢×¨×•×ª ×›×œ×œ×™×•×ª</span></div>
      <Txa value={notes} onChange={e=>setNotes(e.target.value)} placeholder="×”×¢×¨×•×ª ×—×•×¤×©×™×•×ª..." rows={3}/>
    </Card>
    <Btn v="primary" full onClick={()=>save({...log,generalNotes:notes})} sx={{ padding:"14px 24px",fontSize:16,borderRadius:14,marginBottom:10 }}>{Ic.save(18,"#fff")} ×©××•×¨ ×™×•×</Btn>
    <div style={{ textAlign:"center",fontSize:12,color:"#b5afa7",marginBottom:20 }}>×¡×™××•× ×™× × ×©××¨×™× ××•×˜×•××˜×™×ª Â· "×©××•×¨ ×™×•×" ×©×•××¨ ×”×¢×¨×•×ª ×˜×§×¡×˜</div>
  </div>);
}

// ============ MEDS PAGE ============
function Meds({ profile, save }) {
  const [ed, setEd] = useState(null);
  const [sr, setSr] = useState("");
  const [add, setAdd] = useState(false);
  const [as, setAs] = useState("");
  const [af, setAf] = useState("×”×›×œ");
  const [sc, setSc] = useState(false);
  const [cm, setCm] = useState({ name:"",dosage:"",times:"" });
  const cats = ["×”×›×œ",...new Set(MEDICATION_DB.map(m=>m.category))];
  const fa = MEDICATION_DB.filter(m=>!profile.medications.some(p=>p.id===m.id)&&(!as||m.name.includes(as)||m.generic.toLowerCase().includes(as.toLowerCase()))&&(af==="×”×›×œ"||m.category===af));
  const uM = (i,f,v) => { const ms=[...profile.medications]; ms[i]={...ms[i],[f]:v}; save({...profile,medications:ms}); };
  const rM = i => save({...profile,medications:profile.medications.filter((_,j)=>j!==i)});
  const aM = m => save({...profile,medications:[...profile.medications,{...m,dosage:m.dosage||"",times:m.times||""}]});

  return (<div>
    <Card sx={{ padding:16 }}>
      <div style={{ display:"flex",alignItems:"center",gap:10,marginBottom:14 }}><Circ icon="pill" bg="#f3f1ee" color="#6b6058" size={36}/><span style={{ fontWeight:700,fontSize:16 }}>×ª×¨×•×¤×•×ª ×§×‘×•×¢×•×ª ({profile.medications.length})</span></div>
      {profile.medications.length>0&&<Inp value={sr} onChange={e=>setSr(e.target.value)} placeholder="ğŸ” ×—×™×¤×•×©..." sx={{ marginBottom:10 }}/>}
      {profile.medications.filter(m=>!sr||m.name.includes(sr)||(m.generic||"").toLowerCase().includes(sr.toLowerCase())).map((m,i)=>(
        <div key={m.id||i} style={{ display:"flex",alignItems:"flex-start",gap:10,padding:"12px 0",borderBottom:"1px solid #f5f3f0" }}>
          <Circ icon="pill" bg="#f5f3f0" color="#8b7565" size={36}/>
          <div style={{ flex:1 }}>
            <div style={{ fontWeight:600,fontSize:14 }}>{m.name}</div>
            {m.generic&&<div style={{ fontSize:12,color:"#a09890" }}>{m.generic}</div>}
            {(m.dosage||m.times)&&<div style={{ fontSize:12,color:"#6b6058",marginTop:2 }}>{m.dosage}{m.times?` Â· ${m.times}`:""}</div>}
            {ed===i&&<div style={{ display:"flex",gap:6,marginTop:8,flexWrap:"wrap" }}><Inp value={m.dosage||""} onChange={e=>uM(i,"dosage",e.target.value)} placeholder="××™× ×•×Ÿ" sx={{ flex:1,fontSize:13,padding:"6px 10px" }}/><Inp value={m.times||""} onChange={e=>uM(i,"times",e.target.value)} placeholder="×–×× ×™ ××ª×Ÿ" sx={{ flex:1,fontSize:13,padding:"6px 10px" }}/></div>}
          </div>
          <Btn v="soft" sm onClick={()=>setEd(ed===i?null:i)} sx={{ padding:"6px 10px" }}>{Ic.edit(14,"#6b6058")}</Btn>
          <Btn v="soft" sm onClick={()=>rM(i)} sx={{ padding:"6px 10px" }}>{Ic.x(14,"#b5544d")}</Btn>
        </div>
      ))}
      <Btn v="primary" full onClick={()=>setAdd(!add)} sx={{ marginTop:14 }}>{Ic.plus(16,"#fff")} ×”×•×¡×£ ×ª×¨×•×¤×”</Btn>
    </Card>
    {add&&<Card sx={{ padding:16 }}>
      <div style={{ fontWeight:700,fontSize:15,marginBottom:10 }}>×”×•×¡×£ ××”×¨×©×™××”</div>
      <Inp value={as} onChange={e=>setAs(e.target.value)} placeholder="ğŸ” ×—×™×¤×•×©..." sx={{ marginBottom:8 }}/>
      <div style={{ display:"flex",gap:4,flexWrap:"wrap",marginBottom:8 }}>{cats.slice(0,12).map(c=><Tag key={c} on={af===c} onClick={()=>setAf(c)}>{c}</Tag>)}</div>
      <div style={{ maxHeight:240,overflowY:"auto",borderRadius:10,border:"1px solid #eee" }}>
        {fa.slice(0,30).map(m=><div key={m.id} onClick={()=>aM(m)} style={{ display:"flex",alignItems:"center",gap:10,padding:"10px 14px",cursor:"pointer",borderBottom:"1px solid #f8f6f3" }}>{Ic.plus(16,"#5a5650")}<div style={{ flex:1 }}><div style={{ fontWeight:600,fontSize:13 }}>{m.name}</div><div style={{ fontSize:11,color:"#a09890" }}>{m.generic} â€” {m.purpose}</div></div></div>)}
      </div>
      <Btn v="soft" sm full onClick={()=>setSc(!sc)} sx={{ marginTop:8 }}>{Ic.plus(14,"#5a4e42")} ×ª×¨×•×¤×” ××•×ª×××ª</Btn>
      {sc&&<div style={{ background:"#faf9f7",borderRadius:10,padding:12,marginTop:8 }}><Inp value={cm.name} onChange={e=>setCm({...cm,name:e.target.value})} placeholder="×©×" sx={{ marginBottom:6 }}/><div style={{ display:"flex",gap:6 }}><Inp value={cm.dosage} onChange={e=>setCm({...cm,dosage:e.target.value})} placeholder="××™× ×•×Ÿ"/><Inp value={cm.times} onChange={e=>setCm({...cm,times:e.target.value})} placeholder="×–×× ×™ ××ª×Ÿ"/></div><Btn v="primary" sm onClick={()=>{ if(cm.name){ aM({id:`c_${Date.now()}`,name:cm.name,generic:"",category:"××•×ª××",purpose:"",dosage:cm.dosage,times:cm.times}); setCm({name:"",dosage:"",times:""}); setSc(false); }}} sx={{ marginTop:8 }}>×”×•×¡×£</Btn></div>}
    </Card>}
  </div>);
}

// ============ REPORT ============
function Report({ profile }) {
  const [rng, setRng] = useState("week");
  const [logs, setLogs] = useState([]);
  const [busy, setBusy] = useState(false);
  const [show, setShow] = useState(false);
  const gen = async()=>{ setBusy(true); const d=rng==="week"?7:rng==="month"?30:1; const a=[]; for(let i=0;i<d;i++){ const dt=new Date(Date.now()-i*86400000).toISOString().split("T")[0]; try{ const r=await window.storage.get(`log:${dt}`); if(r?.value)a.push(JSON.parse(r.value)); }catch(e){} } setLogs(a.sort((a,b)=>a.date.localeCompare(b.date))); setShow(true); setBusy(false); };
  const mc=()=>{let t=0,g=0;logs.forEach(l=>l.medications?.forEach(m=>{t++;if(m.given)g++}));return t?Math.round(g/t*100):0;};
  const mlc=()=>{let t=0,d=0;logs.forEach(l=>["breakfast","lunch","dinner"].forEach(m=>{t++;if(l.meals?.[m]?.done)d++}));return t?Math.round(d/t*100):0;};
  const ti=()=>logs.reduce((s,l)=>s+(l.incidents?.length||0),0);
  const bd=()=>logs.filter(l=>l.bathing?.done).length;
  const pd=()=>logs.filter(l=>l.physicalActivity?.done).length;
  const cd=()=>logs.filter(l=>l.cognitiveActivity?.done).length;
  const avgFl=()=>{const s=logs.reduce((a,l)=>a+(l.fluids||0),0);return logs.length?Math.round(s/logs.length*10)/10:0;};
  const avgDi=()=>{const s=logs.reduce((a,l)=>a+(l.diapers||0),0);return logs.length?Math.round(s/logs.length*10)/10:0;};
  const ms=()=>{const c={};logs.forEach(l=>{if(l.mood)c[l.mood]=(c[l.mood]||0)+1});return c;};
  const ss=()=>{const c={};logs.forEach(l=>{if(l.sleep)c[l.sleep]=(c[l.sleep]||0)+1});return c;};
  const ds=()=>{const c={};logs.forEach(l=>(l.dementiaSymptoms||[]).forEach(s=>{c[s]=(c[s]||0)+1}));logs.forEach(l=>{if(l.customDementia)c[l.customDementia]=(c[l.customDementia]||0)+1});return c;};
  const T={t:{width:"100%",borderCollapse:"collapse",marginBottom:12,fontSize:12},h:{border:"1px solid #ccc",padding:"6px 8px",background:"#f5f3f0",fontWeight:700,textAlign:"right",fontSize:12},d:{border:"1px solid #e2ddd6",padding:"5px 8px",textAlign:"right",verticalAlign:"top",fontSize:12},c:{border:"1px solid #e2ddd6",padding:"5px 8px",textAlign:"center",verticalAlign:"top",fontSize:12}};

  if(!show)return(<Card sx={{ padding:16 }}><div style={{ display:"flex",alignItems:"center",gap:10,marginBottom:14 }}><Circ icon="clip" bg="#f3f0ec" color="#6b6058" size={36}/><span style={{ fontWeight:700,fontSize:16 }}>×”×¤×§×ª ×“×•×—</span></div><p style={{ fontSize:13,color:"#a09890",marginBottom:10 }}>×“×•×— ××¤×•×¨×˜ ×œ×”×“×¤×¡×”.</p><div style={{ display:"flex",gap:6,marginBottom:14 }}>{[{v:"day",l:"×™×•×"},{v:"week",l:"×©×‘×•×¢"},{v:"month",l:"×—×•×“×©"}].map(r=><Btn key={r.v} v={rng===r.v?"primary":"soft"} sm onClick={()=>setRng(r.v)} sx={{ flex:1 }}>{r.l}</Btn>)}</div><Btn v="primary" full dis={busy} onClick={gen}>{busy?"××¤×™×§...":"×”×¤×§ ×“×•×—"}</Btn></Card>);

  return(<div>
    <div className="no-print"><Card sx={{ display:"flex",gap:8,padding:12 }}><Btn v="outline" onClick={()=>setShow(false)}>×—×–×¨×”</Btn><Btn v="primary" full onClick={()=>window.print()}>{Ic.print(16,"#fff")} ×”×“×¤×¡</Btn></Card></div>
    <div id="printable-report" style={{ background:"#fff",color:"#000",fontFamily:"'Noto Sans Hebrew',sans-serif",direction:"rtl",padding:20,fontSize:13,lineHeight:1.6,borderRadius:14 }}>
      <style>{`@media print{body *{visibility:hidden!important}#printable-report,#printable-report *{visibility:visible!important}#printable-report{position:absolute;top:0;right:0;left:0;padding:20px!important}.no-print{display:none!important}table{page-break-inside:auto}tr{page-break-inside:avoid}}`}</style>
      <h1 style={{ fontSize:20,fontWeight:700,borderBottom:"2px solid #000",paddingBottom:6,marginBottom:10,marginTop:0 }}>×“×•×— ××¢×§×‘ ×˜×™×¤×•×œ×™ â€” {profile.patientName}</h1>
      <div style={{ fontSize:12,color:"#555",marginBottom:3 }}>×ª.×–.: {profile.patientId||"â€”"} | ×ª.×œ×™×“×”: {profile.birthDate||"â€”"} | ×§×•×¤"×—: {profile.kupat||"â€”"}</div>
      <div style={{ fontSize:12,color:"#555",marginBottom:3 }}>××‘×—× ×•×ª: {profile.diagnoses||"â€”"} | ××œ×¨×’×™×•×ª: {profile.allergies||"â€”"}</div>
      <div style={{ fontSize:12,color:"#555",marginBottom:3 }}>××˜×¤×œ/×ª: {profile.caregiverName} | ×¨×•×¤×/×”: {profile.doctorName||"â€”"}</div>
      <div style={{ fontSize:12,color:"#555",marginBottom:3 }}>×ª×§×•×¤×”: {logs.length>0?`${logs[0]?.date} ×¢×“ ${logs[logs.length-1]?.date}`:"â€”"} ({logs.length} ×™××™×)</div>
      <div style={{ fontSize:12,color:"#555",marginBottom:12 }}>×”×•×¤×§: {new Date().toLocaleDateString("he-IL")} {new Date().toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"})}</div>
      <h2 style={{ fontSize:15,fontWeight:700,borderBottom:"1px solid #999",paddingBottom:4,marginTop:16,marginBottom:8 }}>×¡×™×›×•×</h2>
      <table style={T.t}><tbody><tr><td style={T.h}>×¦×™×•×ª ×ª×¨×•×¤×ª×™</td><td style={T.c}>{mc()}%</td></tr><tr><td style={T.h}>××¨×•×—×•×ª</td><td style={T.c}>{mlc()}%</td></tr><tr><td style={T.h}>×©×ª×™×™×” (×××•×¦×¢)</td><td style={T.c}>{avgFl()} ×›×•×¡×•×ª / {Math.round(avgFl()*250)} ×"×œ</td></tr><tr><td style={T.h}>×¨×—×¦×”</td><td style={T.c}>{bd()}/{logs.length}</td></tr><tr><td style={T.h}>×¤×¢' ×’×•×¤× ×™×ª</td><td style={T.c}>{pd()}/{logs.length}</td></tr><tr><td style={T.h}>×¤×¢' ×§×•×’× ×™×˜×™×‘×™×ª</td><td style={T.c}>{cd()}/{logs.length}</td></tr>{profile.useDiapers&&<tr><td style={T.h}>×—×™×ª×•×œ×™× (×××•×¦×¢)</td><td style={T.c}>{avgDi()} / ×™×•×</td></tr>}<tr><td style={T.h}>×—×¨×™×’×™×</td><td style={T.c}>{ti()}</td></tr></tbody></table>
      <h2 style={{ fontSize:15,fontWeight:700,borderBottom:"1px solid #999",paddingBottom:4,marginTop:16,marginBottom:8 }}>×ª×¨×•×¤×•×ª</h2>
      <table style={T.t}><thead><tr><th style={T.h}>×ª×¨×•×¤×”</th><th style={{...T.h,width:70}}>× ×™×ª× ×”</th><th style={{...T.h,width:70}}>×œ×</th><th style={T.h}>×¡×™×‘×•×ª</th></tr></thead><tbody>{profile.medications.map((m,mi)=>{const g=logs.filter(l=>l.medications?.[mi]?.given).length;const rs=logs.filter(l=>l.medications?.[mi]?.reason).map(l=>`${l.date}: ${l.medications[mi].reason}`);return<tr key={mi}><td style={T.d}>{m.name}{m.dosage?` (${m.dosage})`:""}</td><td style={T.c}>{g}/{logs.length}</td><td style={T.c}>{logs.length-g}</td><td style={T.d}>{rs.join(" ; ")||"â€”"}</td></tr>})}</tbody></table>
      {Object.keys(ms()).length>0&&<><h2 style={{ fontSize:15,fontWeight:700,borderBottom:"1px solid #999",paddingBottom:4,marginTop:16,marginBottom:8 }}>××¦×‘ ×¨×•×—</h2><table style={T.t}><thead><tr><th style={T.h}>××¦×‘</th><th style={{...T.h,width:70}}>×™××™×</th></tr></thead><tbody>{Object.entries(ms()).map(([k,v])=><tr key={k}><td style={T.d}>{k}</td><td style={T.c}>{v}</td></tr>)}</tbody></table></>}
      {Object.keys(ss()).length>0&&<><h2 style={{ fontSize:15,fontWeight:700,borderBottom:"1px solid #999",paddingBottom:4,marginTop:16,marginBottom:8 }}>×©×™× ×”</h2><table style={T.t}><thead><tr><th style={T.h}>××™×›×•×ª</th><th style={{...T.h,width:70}}>×™××™×</th></tr></thead><tbody>{Object.entries(ss()).map(([k,v])=><tr key={k}><td style={T.d}>{k}</td><td style={T.c}>{v}</td></tr>)}</tbody></table></>}
      {Object.keys(ds()).length>0&&<><h2 style={{ fontSize:15,fontWeight:700,borderBottom:"1px solid #999",paddingBottom:4,marginTop:16,marginBottom:8 }}>×ª×¡××™× ×™ ×“×× ×¦×™×”</h2><table style={T.t}><thead><tr><th style={T.h}>×ª×¡××™×Ÿ</th><th style={{...T.h,width:70}}>×™××™×</th></tr></thead><tbody>{Object.entries(ds()).map(([k,v])=><tr key={k}><td style={T.d}>{k}</td><td style={T.c}>{v}</td></tr>)}</tbody></table></>}
      {ti()>0&&<><h2 style={{ fontSize:15,fontWeight:700,borderBottom:"1px solid #999",paddingBottom:4,marginTop:16,marginBottom:8 }}>×—×¨×™×’×™× ({ti()})</h2><table style={T.t}><thead><tr><th style={{...T.h,width:85}}>×ª××¨×™×š</th><th style={{...T.h,width:60}}>×©×¢×”</th><th style={{...T.h,width:90}}>×¡×•×’</th><th style={T.h}>×ª×™××•×¨</th></tr></thead><tbody>{logs.flatMap(l=>(l.incidents||[]).map(i=>({...i,date:l.date}))).map((i,j)=><tr key={j}><td style={T.d}>{i.date}</td><td style={T.c}>{i.time||"â€”"}</td><td style={T.d}>{i.type}</td><td style={T.d}>{i.description||"â€”"}</td></tr>)}</tbody></table></>}
      {logs.some(l=>l.doctorVisit?.done)&&<><h2 style={{ fontSize:15,fontWeight:700,borderBottom:"1px solid #999",paddingBottom:4,marginTop:16,marginBottom:8 }}>×‘×™×§×•×¨×™ ×¨×•×¤×</h2><table style={T.t}><thead><tr><th style={{...T.h,width:85}}>×ª××¨×™×š</th><th style={T.h}>×¨×•×¤×/×”</th><th style={T.h}>×¡×™×‘×”</th><th style={T.h}>×¡×™×›×•×</th></tr></thead><tbody>{logs.filter(l=>l.doctorVisit?.done).map((l,i)=><tr key={i}><td style={T.d}>{l.date}</td><td style={T.d}>{l.doctorVisit.doctor||"â€”"}</td><td style={T.d}>{l.doctorVisit.reason||"â€”"}</td><td style={T.d}>{l.doctorVisit.notes||"â€”"}</td></tr>)}</tbody></table></>}
      <h2 style={{ fontSize:15,fontWeight:700,borderBottom:"1px solid #999",paddingBottom:4,marginTop:16,marginBottom:8 }}>×¤×™×¨×•×˜ ×™×•××™</h2>
      {logs.map((l,li)=><div key={li} style={{ borderTop:"2px solid #333",paddingTop:8,marginTop:14,pageBreakInside:"avoid" }}><h3 style={{ fontSize:14,fontWeight:700,marginBottom:6,color:"#333" }}>{fmtD(l.date)}</h3><table style={T.t}><thead><tr><th style={T.h}>×ª×¨×•×¤×”</th><th style={{...T.h,width:55}}>×¡×˜×˜×•×¡</th><th style={{...T.h,width:55}}>×©×¢×”</th><th style={T.h}>×”×¢×¨×”</th></tr></thead><tbody>{(l.medications||[]).map((m,mi)=><tr key={mi}><td style={T.d}>{m.name}</td><td style={T.c}>{m.given?"× ×™×ª× ×”":"×œ×"}</td><td style={T.c}>{m.time||"â€”"}</td><td style={T.d}>{m.reason||"â€”"}</td></tr>)}</tbody></table><table style={T.t}><tbody>
        <tr><td style={T.h}>×¨×—×¦×”/×”×™×’×™×™× ×”</td><td style={T.d}>{(l.bathing?.types||[]).length>0?(l.bathing.types.join(", "))+(l.bathing.notes?` â€” ${l.bathing.notes}`:""):"×œ× ×‘×•×¦×¢×”"}</td></tr>
        <tr><td style={T.h}>×‘×•×§×¨</td><td style={T.d}>{l.meals?.breakfast?.done?`×›×Ÿ${l.meals.breakfast.notes?` â€” ${l.meals.breakfast.notes}`:""}`:"×œ×"}</td></tr>
        <tr><td style={T.h}>×¦×”×¨×™×™×</td><td style={T.d}>{l.meals?.lunch?.done?`×›×Ÿ${l.meals.lunch.notes?` â€” ${l.meals.lunch.notes}`:""}`:"×œ×"}</td></tr>
        <tr><td style={T.h}>×¢×¨×‘</td><td style={T.d}>{l.meals?.dinner?.done?`×›×Ÿ${l.meals.dinner.notes?` â€” ${l.meals.dinner.notes}`:""}`:"×œ×"}</td></tr>
        <tr><td style={T.h}>×‘×™× ×™×™×</td><td style={T.d}>{l.meals?.snacks?.done?`×›×Ÿ${l.meals.snacks.notes?` â€” ${l.meals.snacks.notes}`:""}`:"â€”"}</td></tr>
        <tr><td style={T.h}>×©×ª×™×™×”</td><td style={T.d}>{(l.fluids||0)} ×›×•×¡×•×ª ({(l.fluids||0)*250} ×"×œ)</td></tr>
        <tr><td style={T.h}>×¦×¨×›×™×</td><td style={T.d}>{(l.toileting||[]).length>0?l.toileting.map(t=>`${t.time} ${t.type}${t.notes?` (${t.notes})`:""}`).join(" | "):"â€”"}</td></tr>
        {profile.useDiapers&&<tr><td style={T.h}>×—×™×ª×•×œ×™×</td><td style={T.d}>{l.diapers||0} ×”×—×œ×¤×•×ª</td></tr>}
        <tr><td style={T.h}>×¤×¢' ×’×•×¤× ×™×ª</td><td style={T.d}>{l.physicalActivity?.done?`${l.physicalActivity.type||"×‘×•×¦×¢×”"}${l.physicalActivity.duration?` â€” ${l.physicalActivity.duration} ×“×§'`:""}${l.physicalActivity.notes?` â€” ${l.physicalActivity.notes}`:""}`:"×œ×"}</td></tr>
        <tr><td style={T.h}>×¤×¢' ×§×•×’× ×™×˜×™×‘×™×ª</td><td style={T.d}>{l.cognitiveActivity?.done?`${l.cognitiveActivity.type||"×‘×•×¦×¢×”"}${l.cognitiveActivity.duration?` â€” ${l.cognitiveActivity.duration} ×“×§'`:""}${l.cognitiveActivity.notes?` â€” ${l.cognitiveActivity.notes}`:""}`:"×œ×"}</td></tr>
        <tr><td style={T.h}>××¦×‘ ×¨×•×—</td><td style={T.d}>{l.mood||"â€”"}</td></tr>
        {(l.dementiaSymptoms||[]).length>0&&<tr><td style={T.h}>×ª×¡××™× ×™ ×“×× ×¦×™×”</td><td style={T.d}>{[...(l.dementiaSymptoms||[]),l.customDementia].filter(Boolean).join(", ")}</td></tr>}
        <tr><td style={T.h}>×©×™× ×”</td><td style={T.d}>{l.sleep||"â€”"}</td></tr>
        {l.doctorVisit?.done&&<tr><td style={T.h}>×‘×™×§×•×¨ ×¨×•×¤×</td><td style={T.d}>{l.doctorVisit.doctor} â€” {l.doctorVisit.reason}{l.doctorVisit.notes?` â€” ${l.doctorVisit.notes}`:""}</td></tr>}
        {(l.incidents||[]).length>0&&<tr><td style={T.h}>×—×¨×™×’×™×</td><td style={T.d}>{l.incidents.map(i=>`${i.time} ${i.type}: ${i.description}`).join(" | ")}</td></tr>}
        {l.generalNotes&&<tr><td style={T.h}>×”×¢×¨×•×ª</td><td style={T.d}>{l.generalNotes}</td></tr>}
      </tbody></table></div>)}
      {logs.length===0&&<div style={{ textAlign:"center",padding:24,color:"#999" }}>×œ× × ××¦××• × ×ª×•× ×™×.</div>}
      <div style={{ marginTop:24,borderTop:"1px solid #999",paddingTop:6,fontSize:11,color:"#999",textAlign:"center" }}>×“×•×— ××¢×¨×›×ª × ×™×”×•×œ ×˜×™×¤×•×œ | {new Date().toLocaleDateString("he-IL")}</div>
    </div>
  </div>);
}

// ============ PROFILE ============
function Profile({ profile, save }) {
  const [ed, setEd] = useState(false);
  const [f, sF] = useState(profile);
  const [del, setDel] = useState(false);
  const sv = ()=>{ save(f); setEd(false); };
  const rm = async()=>{ try{ await window.storage.delete("care-profile"); const ks=await window.storage.list("log:"); if(ks?.keys)for(const k of ks.keys)await window.storage.delete(k); }catch(e){} window.location.reload(); };

  return(<div>
    <Card sx={{ padding:16 }}>
      <div style={{ display:"flex",alignItems:"center",gap:10,marginBottom:16 }}><Circ icon="user" bg="#f3f0ec" color="#6b6058" size={36}/><span style={{ fontWeight:700,fontSize:16 }}>×¤×¨×•×¤×™×œ</span></div>
      {!ed?<div>
        {[{l:"×©×",v:profile.patientName},{l:"×ª.×–.",v:profile.patientId},{l:"×ª.×œ×™×“×”",v:profile.birthDate},{l:"×§×•×¤\"×—",v:profile.kupat},{l:"××‘×—× ×•×ª",v:profile.diagnoses},{l:"××œ×¨×’×™×•×ª",v:profile.allergies},{l:"×—×™×ª×•×œ×™×",v:profile.useDiapers?"×›×Ÿ":"×œ×"}].filter(x=>x.v).map(x=><div key={x.l} style={{ marginBottom:6 }}><span style={{ fontSize:12,fontWeight:600,color:"#a09890" }}>{x.l}</span><div style={{ fontSize:14 }}>{x.v}</div></div>)}
        <hr style={{ border:"none",borderTop:"1px solid #f0ede8",margin:"14px 0" }}/>
        {[{l:"××˜×¤×œ/×ª",v:profile.caregiverName},{l:"×˜×œ×¤×•×Ÿ",v:profile.caregiverPhone},{l:"×¨×•×¤×/×”",v:profile.doctorName},{l:"×˜×œ' ×¨×•×¤×/×”",v:profile.doctorPhone},{l:"×—×™×¨×•×",v:`${profile.emergencyContact||""} ${profile.emergencyPhone||""}`.trim()}].filter(x=>x.v).map(x=><div key={x.l} style={{ marginBottom:6 }}><span style={{ fontSize:12,fontWeight:600,color:"#a09890" }}>{x.l}</span><div style={{ fontSize:14 }}>{x.v}</div></div>)}
        <Btn v="soft" full onClick={()=>{sF(profile);setEd(true)}} sx={{ marginTop:14 }}>{Ic.edit(16,"#5a4e42")} ×¢×¨×•×š</Btn>
      </div>:<div>
        {[["patientName","×©×"],["patientId","×ª.×–."],["kupat","×§×•×¤\"×—"],["caregiverName","××˜×¤×œ/×ª"],["caregiverPhone","×˜×œ×¤×•×Ÿ ××˜×¤×œ/×ª"],["doctorName","×¨×•×¤×/×”"],["doctorPhone","×˜×œ' ×¨×•×¤×/×”"],["emergencyContact","×—×™×¨×•×"],["emergencyPhone","×˜×œ' ×—×™×¨×•×"]].map(([k,l])=><div key={k} style={{ marginBottom:8 }}><label style={{ fontSize:12,fontWeight:600,color:"#a09890",display:"block",marginBottom:3 }}>{l}</label><Inp type={k==="birthDate"?"date":"text"} value={f[k]||""} onChange={e=>sF({...f,[k]:e.target.value})}/></div>)}
        <div style={{ marginBottom:8 }}><label style={{ fontSize:12,fontWeight:600,color:"#a09890",display:"block",marginBottom:3 }}>×ª.×œ×™×“×”</label><Inp type="date" value={f.birthDate||""} onChange={e=>sF({...f,birthDate:e.target.value})}/></div>
        <div style={{ marginBottom:8 }}><label style={{ fontSize:12,fontWeight:600,color:"#a09890",display:"block",marginBottom:3 }}>××‘×—× ×•×ª</label><Txa value={f.diagnoses||""} onChange={e=>sF({...f,diagnoses:e.target.value})} rows={2}/></div>
        <div style={{ marginBottom:8 }}><label style={{ fontSize:12,fontWeight:600,color:"#a09890",display:"block",marginBottom:3 }}>××œ×¨×’×™×•×ª</label><Txa value={f.allergies||""} onChange={e=>sF({...f,allergies:e.target.value})} rows={2}/></div>
        <div onClick={()=>sF({...f,useDiapers:!f.useDiapers})} style={{ display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderRadius:10,cursor:"pointer",background:f.useDiapers?"#f3f1ee":"#faf9f7",border:f.useDiapers?"1.5px solid #5a5650":"1.5px solid #e2ddd6",marginBottom:8 }}><Chk on={f.useDiapers} toggle={()=>{}}/><span style={{ fontWeight:600,fontSize:13 }}>×”××˜×•×¤×œ/×ª ××©×ª××©/×ª ×‘×—×™×ª×•×œ×™×</span></div>
        <div style={{ display:"flex",gap:8,marginTop:14 }}><Btn v="outline" onClick={()=>setEd(false)}>×‘×™×˜×•×œ</Btn><Btn v="primary" full onClick={sv}>{Ic.save(16,"#fff")} ×©××•×¨</Btn></div>
      </div>}
    </Card>
    <Card sx={{ padding:16 }}>
      {!del?<Btn v="danger" full onClick={()=>setDel(true)}>××—×§ ××ª ×›×œ ×”× ×ª×•× ×™×</Btn>:<div style={{ textAlign:"center" }}><p style={{ fontSize:13,color:"#b5544d",fontWeight:600,marginBottom:10 }}>×›×œ ×”× ×ª×•× ×™× ×™×™××—×§×•. ×‘×˜×•×—/×”?</p><div style={{ display:"flex",gap:8 }}><Btn v="outline" onClick={()=>setDel(false)} sx={{ flex:1 }}>×‘×™×˜×•×œ</Btn><Btn v="danger" onClick={rm} sx={{ flex:1 }}>××—×§</Btn></div></div>}
    </Card>
  </div>);
}


const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(React.createElement(CareApp));
</script>
</body>
</html>